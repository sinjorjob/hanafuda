<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã™ã„ã¡ã‚ƒã‚“ã®èŠ±æœ­ ï½Demon Hunters ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï½</title>
  <!-- Google Fonts: å­ä¾›å‘ã‘ã®ä¸¸ãã¦ã‹ã‚ã„ã„ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&family=Kiwi+Maru:wght@400;500&display=swap" rel="stylesheet">

  <!-- PWAè¨­å®š -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4dd0e1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="èŠ±æœ­">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    /* ========== ãƒªã‚»ãƒƒãƒˆãƒ»åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« ========== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Zen Maru Gothic', 'Kiwi Maru', 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
      background: linear-gradient(135deg, #e8f5e9 0%, #fce4ec 50%, #fff8e1 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ========== CSSå¤‰æ•°ï¼ˆå­ä¾›å‘ã‘ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼ï¼‰ ========== */
    :root {
      --primary-color: #4dd0e1;      /* ã‚„ã‚ã‚‰ã‹ã„ã‚·ã‚¢ãƒ³ */
      --primary-light: #80deea;      /* æ˜ã‚‹ã„ã‚·ã‚¢ãƒ³ */
      --primary-dark: #26c6da;       /* æ¿ƒã„ã‚·ã‚¢ãƒ³ */
      --secondary-color: #ba68c8;    /* ã‚„ã‚ã‚‰ã‹ã„ãƒ‘ãƒ¼ãƒ—ãƒ« */
      --secondary-light: #ce93d8;    /* æ˜ã‚‹ã„ãƒ‘ãƒ¼ãƒ—ãƒ« */
      --accent-color: #f48fb1;       /* ã‚„ã‚ã‚‰ã‹ã„ãƒ”ãƒ³ã‚¯ */
      --accent-light: #f8bbd9;       /* æ˜ã‚‹ã„ãƒ”ãƒ³ã‚¯ */
      --yellow-color: #ffee58;       /* ã‚„ã‚ã‚‰ã‹ã„ã‚¤ã‚¨ãƒ­ãƒ¼ */
      --yellow-light: #fff59d;       /* æ˜ã‚‹ã„ã‚¤ã‚¨ãƒ­ãƒ¼ */
      --orange-color: #ffb74d;       /* ã‚ªãƒ¬ãƒ³ã‚¸ */
      --green-color: #81c784;        /* ã‚„ã‚ã‚‰ã‹ã„ã‚°ãƒªãƒ¼ãƒ³ */
      --dark-color: #5d4e6d;         /* ã‚„ã‚ã‚‰ã‹ã„ãƒ€ãƒ¼ã‚¯ */
      --light-color: #ffffff;
      --bg-light: #fafafa;
      --card-width: 60px;
      --card-height: 94px;
      --card-radius: 8px;
      --shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.1);
      --shadow-glow: 0 0 20px rgba(77, 208, 225, 0.4);
    }

    /* ========== å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ========== */
    .screen {
      display: none;
      width: 100%;
      min-height: 100vh;
      padding: 20px;
    }

    .screen.active {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* ========== ãƒ•ãƒ©ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ»ã‹ã‚ã„ã„ï¼‰ ========== */
    .btn {
      position: relative;
      background: linear-gradient(180deg,
        var(--primary-light) 0%,
        var(--primary-color) 100%);
      border: none;
      border-radius: 50px;
      padding: 16px 40px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(77, 208, 225, 0.4);
      transition: all 0.2s ease;
      margin: 12px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      letter-spacing: 1px;
    }

    /* ãƒœã‚¿ãƒ³å…‰æ²¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 50%;
      background: linear-gradient(180deg,
        rgba(255, 255, 255, 0.3) 0%,
        rgba(255, 255, 255, 0.05) 100%);
      border-radius: 50px 50px 100px 100px;
      pointer-events: none;
    }

    .btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(77, 208, 225, 0.5);
      filter: brightness(1.08);
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 2px 10px rgba(77, 208, 225, 0.4);
    }

    /* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ï¼ˆãƒ”ãƒ³ã‚¯ï¼‰ */
    .btn-secondary {
      background: linear-gradient(180deg,
        var(--accent-light) 0%,
        var(--accent-color) 100%);
      box-shadow: 0 4px 15px rgba(244, 143, 177, 0.4);
    }

    .btn-secondary:hover {
      box-shadow: 0 8px 25px rgba(244, 143, 177, 0.5);
    }

    /* ã‚¤ã‚¨ãƒ­ãƒ¼ãƒœã‚¿ãƒ³ */
    .btn-yellow {
      background: linear-gradient(180deg,
        var(--yellow-light) 0%,
        var(--yellow-color) 100%);
      color: #5d4037;
      text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
      box-shadow: 0 4px 15px rgba(255, 238, 88, 0.4);
    }

    .btn-yellow:hover {
      box-shadow: 0 8px 25px rgba(255, 238, 88, 0.5);
    }

    /* ã‚°ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³ */
    .btn-green {
      background: linear-gradient(180deg,
        #a5d6a7 0%,
        var(--green-color) 100%);
      box-shadow: 0 4px 15px rgba(129, 199, 132, 0.4);
    }

    .btn-small {
      padding: 10px 24px;
      font-size: 14px;
    }

    .btn-small:hover {
      transform: translateY(-2px) scale(1.02);
    }

    .btn-small:active {
      transform: translateY(1px) scale(0.98);
    }

    /* ========== ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ ========== */
    #title-screen {
      justify-content: center;
      text-align: center;
      background:
        linear-gradient(180deg, rgba(224, 247, 250, 0.9) 0%, rgba(243, 229, 245, 0.9) 50%, rgba(255, 248, 225, 0.9) 100%);
      position: relative;
    }

    #title-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('images/sample1.jpg');
      background-size: cover;
      background-position: center;
      opacity: 0.55;
      pointer-events: none;
    }

    .title-logo {
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 48px;
      font-weight: 900;
      background: linear-gradient(180deg,
        #ff6b9d 0%,
        var(--secondary-color) 50%,
        #7c4dff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(3px 3px 0 #fff) drop-shadow(-1px -1px 0 #fff);
      margin-bottom: 10px;
      letter-spacing: 6px;
      position: relative;
      z-index: 1;
      animation: titleBounce 2s ease-in-out infinite;
    }

    @keyframes titleBounce {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.02); }
    }

    .title-subtitle {
      font-family: 'Kiwi Maru', sans-serif;
      font-size: 20px;
      color: var(--accent-color);
      margin-bottom: 25px;
      font-weight: 500;
      position: relative;
      z-index: 1;
      text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
      animation: subtitleFloat 3s ease-in-out infinite;
    }

    @keyframes subtitleFloat {
      0%, 100% { transform: translateY(0); opacity: 1; }
      50% { transform: translateY(-5px); opacity: 0.9; }
    }

    .title-character {
      width: 280px;
      max-width: 90%;
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(156, 39, 176, 0.3);
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
      border: 4px solid white;
    }

    .title-cards {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      position: relative;
      z-index: 1;
    }

    .title-cards img {
      width: 55px;
      height: 86px;
      border-radius: 6px;
      box-shadow: 0 4px 15px rgba(0, 188, 212, 0.4);
      animation: float 3s ease-in-out infinite;
      border: 3px solid white;
    }

    .title-cards img:nth-child(2) { animation-delay: 0.5s; }
    .title-cards img:nth-child(3) { animation-delay: 1s; }
    .title-cards img:nth-child(4) { animation-delay: 1.5s; }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .menu-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      position: relative;
      z-index: 1;
    }

    /* ========== ã‚²ãƒ¼ãƒ ç”»é¢ ========== */
    #game-screen {
      background:
        linear-gradient(180deg, #e0f7fa 0%, #f3e5f5 50%, #fff8e1 100%);
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
    }

    #game-screen > * {
      position: relative;
      z-index: 1;
    }

    #game-screen > .score-panel {
      position: fixed;
    }

    #game-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('images/sample3.jpeg');
      background-size: cover;
      background-position: center top;
      opacity: 0.45;
      pointer-events: none;
    }

    .game-header {
      width: 100%;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding: 5px 10px;
      color: var(--dark-color);
      font-size: 13px;
      position: relative;
    }

    .game-rule-hint {
      background: linear-gradient(90deg,
        transparent,
        rgba(255, 255, 255, 0.9),
        transparent);
      border: none;
      border-radius: 20px;
      padding: 6px 20px;
      margin: 0 auto 5px auto;
      color: var(--secondary-color);
      font-family: 'Kiwi Maru', sans-serif;
      font-size: 12px;
      font-weight: 500;
      text-align: center;
      max-width: 400px;
      position: relative;
      z-index: 1;
      box-shadow: 0 2px 10px rgba(186, 104, 200, 0.1);
    }

    .player-area {
      width: 100%;
      max-width: 800px;
      margin: 2px 0;
    }

    .area-label {
      font-family: 'Zen Maru Gothic', sans-serif;
      color: var(--dark-color);
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 4px;
      padding: 4px 12px;
      background: linear-gradient(90deg, rgba(255,255,255,0.8), transparent);
      border-radius: 15px;
      display: inline-block;
    }

    .hand-count {
      color: var(--secondary-color);
      font-weight: 700;
      background: rgba(186, 104, 200, 0.15);
      padding: 2px 8px;
      border-radius: 10px;
      margin-left: 5px;
    }

    .hand-count.last-cards {
      color: var(--accent-color);
      background: rgba(244, 143, 177, 0.2);
      animation: pulseGlow 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    @keyframes pulseGlow {
      0%, 100% {
        opacity: 1;
        box-shadow: 0 0 8px rgba(244, 143, 177, 0.5);
      }
      50% {
        opacity: 0.8;
        box-shadow: 0 0 15px rgba(244, 143, 177, 0.8);
      }
    }

    .cards-container {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
      padding: 5px 8px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      min-height: 90px;
      border: 2px solid rgba(0, 188, 212, 0.3);
      position: relative;
      z-index: 1;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .field-area .cards-container {
      background: rgba(255, 255, 255, 0.85);
      border: 3px solid var(--primary-color);
      min-height: 95px;
      box-shadow: 0 4px 20px rgba(0, 188, 212, 0.2);
    }

    /* ========== ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« ========== */
    .card {
      width: var(--card-width);
      height: var(--card-height);
      border-radius: var(--card-radius);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: var(--card-radius);
      box-shadow: 2px 2px 8px rgba(0,0,0,0.4);
    }

    .card:hover:not(.disabled) {
      transform: translateY(-8px);
      z-index: 10;
    }

    .card.selected {
      transform: translateY(-15px) scale(1.05);
      box-shadow:
        0 0 0 4px var(--yellow-color),
        0 0 25px rgba(255, 238, 88, 0.8),
        0 10px 20px rgba(0, 0, 0, 0.2);
      animation: selectedPulse 0.8s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% {
        box-shadow:
          0 0 0 4px var(--yellow-color),
          0 0 25px rgba(255, 238, 88, 0.8),
          0 10px 20px rgba(0, 0, 0, 0.2);
      }
      50% {
        box-shadow:
          0 0 0 6px var(--yellow-light),
          0 0 35px rgba(255, 238, 88, 1),
          0 10px 20px rgba(0, 0, 0, 0.2);
      }
    }

    .card.disabled {
      cursor: default;
      opacity: 0.6;
      filter: grayscale(30%);
    }

    .card.matched {
      animation: matchPulse 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes matchPulse {
      0% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      }
      40% {
        transform: scale(1.25) rotate(5deg);
        box-shadow:
          0 0 0 5px var(--green-color),
          0 0 40px rgba(129, 199, 132, 0.9);
      }
      70% {
        transform: scale(1.15) rotate(-3deg);
      }
      100% {
        transform: scale(1) rotate(0);
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      }
    }

    .card.face-down img {
      content: url('https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/back.jpeg');
    }

    /* ========== ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ========== */
    .card.dragging {
      opacity: 0.9;
      transform: scale(1.15) rotate(5deg);
      z-index: 1000;
      pointer-events: none;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5);
    }

    .card.drag-source {
      opacity: 0.3;
    }

    .card.drop-target {
      animation: dropTargetPulse 0.6s ease-in-out infinite;
      box-shadow: 0 0 30px rgba(0,255,100,1), 0 0 60px rgba(0,255,100,0.6);
      border: 4px solid #00ff64 !important;
      z-index: 100;
      overflow: visible;
    }

    .card.drop-target::after {
      content: 'ã“ã“ï¼';
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: #00ff64;
      color: #000;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      white-space: nowrap;
      animation: bounceLabel 0.6s ease-in-out infinite;
    }

    @keyframes dropTargetPulse {
      0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(0,255,100,1), 0 0 60px rgba(0,255,100,0.6); }
      50% { transform: scale(1.1); box-shadow: 0 0 40px rgba(0,255,100,1), 0 0 80px rgba(0,255,100,0.8); }
    }

    @keyframes bounceLabel {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-5px); }
    }

    .drag-ghost {
      position: fixed;
      pointer-events: none;
      z-index: 2000;
      transition: none;
    }

    /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚¬ã‚¤ãƒ‰è¡¨ç¤º */
    .drag-guide {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--primary-color), #0097a7);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: bold;
      z-index: 1500;
      display: none;
      animation: guideAppear 0.3s ease-out;
      box-shadow: 0 4px 20px rgba(0, 188, 212, 0.4);
      text-align: center;
      line-height: 1.4;
      max-width: 280px;
      border: 3px solid white;
    }

    .drag-guide.active {
      display: block;
    }

    .drag-guide.no-match {
      background: linear-gradient(135deg, var(--yellow-color), #ff8f00);
      color: var(--dark-color);
      box-shadow: 0 4px 20px rgba(255, 193, 7, 0.4);
    }

    @keyframes guideAppear {
      from { opacity: 0; transform: translateX(-50%) translateY(20px) scale(0.9); }
      to { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-50%) translateY(10px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    /* ã‚¿ãƒƒãƒæ“ä½œæœ€é©åŒ– */
    .card.touchable {
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    .player-area-bottom .card.touchable:active {
      transform: scale(1.05);
    }

    /* ========== å±±æœ­ãƒ»å¾—ç‚¹ã‚¨ãƒªã‚¢ ========== */
    .game-info {
      width: 100%;
      max-width: 800px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      margin-top: 3px;
      color: var(--dark-color);
    }

    #deck-count {
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 15px;
      border-radius: 20px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-weight: 700;
      font-size: 14px;
      color: var(--dark-color);
      border: 2px solid var(--primary-light);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }

    .deck-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .deck-card {
      width: 45px;
      height: 70px;
      background: url('https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/back.jpeg');
      background-size: cover;
      border-radius: 4px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.4);
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    .deck-card.clickable {
      cursor: pointer;
      animation: deckPulse 0.8s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.4);
    }

    .deck-card.clickable:hover {
      transform: scale(1.1);
    }

    .deck-card.clickable::after {
      content: 'ã‚¿ãƒƒãƒ—ï¼';
      position: absolute;
      top: 50%;
      left: calc(100% + 10px);
      transform: translateY(-50%);
      background: linear-gradient(180deg,
        var(--yellow-light) 0%,
        var(--yellow-color) 100%);
      color: #5d4037;
      padding: 8px 14px;
      border-radius: 20px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 13px;
      font-weight: 700;
      white-space: nowrap;
      animation: tapBounce 0.6s ease-in-out infinite;
      box-shadow: 0 3px 12px rgba(255, 238, 88, 0.5);
    }

    @keyframes tapBounce {
      0%, 100% {
        transform: translateY(-50%) scale(1);
      }
      50% {
        transform: translateY(-50%) scale(1.08);
      }
    }

    .deck-area {
      position: relative;
      overflow: visible;
    }

    @keyframes deckPulse {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.4); }
      50% { box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 215, 0, 0.6); }
    }

    .score-display {
      /* è©³ç´°ã‚¹ã‚³ã‚¢ãƒ‘ãƒãƒ«ãŒã‚ã‚‹ãŸã‚éè¡¨ç¤º */
      display: none;
    }

    /* ========== ç‚¹æ•°ãƒ‘ãƒãƒ«ï¼ˆè©³ç´°è¡¨ç¤ºï¼‰ ========== */
    .score-panel {
      position: fixed;
      top: 45px;
      right: 10px;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid var(--primary-light);
      border-radius: 20px;
      padding: 12px 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      z-index: 100;
      min-width: 130px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 12px;
      color: var(--dark-color);
    }

    .score-panel h4 {
      margin: 0 0 8px 0;
      padding-bottom: 6px;
      border-bottom: 2px dashed var(--secondary-light);
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      color: var(--secondary-color);
    }

    .score-row {
      display: flex;
      justify-content: space-between;
      margin: 2px 0;
      padding: 2px 0;
      font-size: 10px;
    }

    .score-row.player {
      color: var(--primary-color);
      font-weight: bold;
    }

    .score-row.cpu {
      color: var(--accent-color);
    }

    .score-row.difference {
      border-top: 1px dashed var(--primary-color);
      padding-top: 5px;
      margin-top: 5px;
    }

    .score-row.winning {
      color: #4CAF50;
      font-weight: bold;
    }

    .score-row.losing {
      color: var(--accent-color);
      font-weight: bold;
    }

    .score-row.tie {
      color: var(--secondary-color);
    }

    /* ========== CPUã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º ========== */
    .cpu-action-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      color: var(--dark-color);
      padding: 25px 40px;
      border-radius: 20px;
      font-size: 18px;
      text-align: center;
      z-index: 200;
      display: none;
      animation: fadeInScale 0.3s ease-out;
      border: 3px solid var(--accent-color);
      box-shadow: 0 8px 30px rgba(233, 30, 99, 0.3);
    }

    .cpu-action-overlay.active {
      display: block;
    }

    .cpu-action-overlay .action-icon {
      font-size: 40px;
      margin-bottom: 10px;
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    /* ========== ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ========== */
    .error-toast {
      position: fixed;
      bottom: 150px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid var(--accent-color);
      color: var(--accent-color);
      padding: 15px 30px;
      border-radius: 15px;
      font-size: 16px;
      font-weight: bold;
      z-index: 300;
      display: none;
      animation: shakeToast 0.5s ease-out;
      box-shadow: 0 4px 20px rgba(233, 30, 99, 0.3);
    }

    .error-toast.active {
      display: block;
    }

    @keyframes shakeToast {
      0%, 100% { transform: translateX(-50%); }
      20%, 60% { transform: translateX(-50%) translateX(-10px); }
      40%, 80% { transform: translateX(-50%) translateX(10px); }
    }

    /* æƒ…å ±ãƒˆãƒ¼ã‚¹ãƒˆ */
    .info-toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid var(--primary-color);
      color: var(--dark-color);
      padding: 20px 35px;
      border-radius: 15px;
      font-size: 18px;
      font-weight: bold;
      z-index: 2500;
      display: none;
      text-align: center;
      line-height: 1.5;
      box-shadow: 0 8px 30px rgba(0, 188, 212, 0.3);
      animation: infoAppear 0.3s ease-out;
    }

    .info-toast.active {
      display: block;
    }

    @keyframes infoAppear {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    /* ========== ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆCPUæ“ä½œä¸­ï¼‰ ========== */
    .card.cpu-highlight {
      box-shadow: 0 0 30px rgba(255,100,100,0.9);
      transform: scale(1.1);
      z-index: 100;
    }

    .card.match-highlight {
      animation: matchGlow 0.8s ease-in-out;
    }

    @keyframes matchGlow {
      0%, 100% {
        box-shadow:
          0 0 0 3px var(--green-color),
          0 0 15px rgba(129, 199, 132, 0.6);
      }
      50% {
        box-shadow:
          0 0 0 5px var(--green-color),
          0 0 35px rgba(129, 199, 132, 1);
        transform: scale(1.08);
      }
    }

    /* ========== ã‚«ãƒ¼ãƒ‰ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ========== */
    .animation-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 500;
    }

    .animated-card {
      position: fixed;
      width: var(--card-width);
      height: var(--card-height);
      border-radius: var(--card-radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      z-index: 501;
      transition: all 0.8s ease-in-out;
    }

    .animated-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: var(--card-radius);
    }

    .animated-card.flipping {
      animation: cardFlip 0.6s ease-in-out;
    }

    @keyframes cardFlip {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(90deg); }
      100% { transform: rotateY(0deg); }
    }

    .animated-card.matched {
      animation: matchedPulse 0.8s ease-in-out;
    }

    @keyframes matchedPulse {
      0% { box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
      50% { box-shadow: 0 0 50px rgba(255,215,0,1), 0 0 80px rgba(255,215,0,0.5); transform: scale(1.15); }
      100% { box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    }

    /* ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºï¼ˆå¤§ããªèª¬æ˜ï¼‰ */
    .step-display {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      color: var(--dark-color);
      padding: 30px 50px;
      border-radius: 25px;
      font-size: 22px;
      text-align: center;
      z-index: 600;
      display: none;
      line-height: 1.6;
      max-width: 90%;
      border: 3px solid var(--secondary-color);
      box-shadow: 0 10px 40px rgba(156, 39, 176, 0.3);
    }

    .step-display.active {
      display: block;
      animation: stepFadeIn 0.4s ease-out;
    }

    .step-display .step-icon {
      font-size: 50px;
      margin-bottom: 15px;
      display: block;
    }

    .step-display .step-sub {
      font-size: 16px;
      color: #777;
      margin-top: 10px;
    }

    @keyframes stepFadeIn {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    /* çŸ¢å°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .arrow-indicator {
      position: fixed;
      font-size: 40px;
      z-index: 502;
      animation: arrowBounce 0.5s ease-in-out infinite;
    }

    @keyframes arrowBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* ========== å–ã‚Šæœ­ã‚¨ãƒªã‚¢ ========== */
    .captured-area {
      width: 100%;
      max-width: 800px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 3px;
      position: relative;
      z-index: 1;
    }

    .captured-section {
      flex: 1;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      padding: 5px 8px;
      border: 2px solid #ddd;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .captured-section.player-captured {
      border-color: var(--primary-color);
      background: rgba(224, 247, 250, 0.8);
    }

    .captured-section.cpu-captured {
      border-color: var(--accent-color);
      background: rgba(252, 228, 236, 0.8);
    }

    .captured-section h4 {
      color: var(--dark-color);
      font-size: 10px;
      font-weight: bold;
      margin: 0 0 3px 0;
    }

    .captured-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
    }

    .captured-cards .card {
      width: 30px;
      height: 47px;
    }

    .captured-cards .card img {
      width: 100%;
      height: 100%;
    }

    /* å–ã‚Šæœ­ã®ç‚¹æ•°ãƒãƒƒã‚¸ */
    .captured-cards .card {
      position: relative;
    }

    .captured-cards .card .point-badge {
      position: absolute;
      bottom: 2px;
      right: 2px;
      background: var(--secondary-color);
      color: white;
      font-size: 9px;
      font-weight: bold;
      padding: 1px 3px;
      border-radius: 3px;
      line-height: 1;
    }

    .captured-cards .card .point-badge.high-point {
      background: var(--accent-color);
      color: white;
    }

    /* ========== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º ========== */
    .message-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    .message-overlay.active {
      display: flex;
    }

    .message-box {
      background: rgba(255, 255, 255, 0.98);
      border: 3px solid var(--secondary-light);
      border-radius: 30px;
      padding: 35px 55px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(156, 39, 176, 0.2);
      animation: popBounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 90%;
    }

    @keyframes popBounce {
      0% { transform: scale(0.3) translateY(50px); opacity: 0; }
      50% { transform: scale(1.05) translateY(-10px); }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    .message-box h2 {
      font-family: 'Zen Maru Gothic', sans-serif;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 18px;
      font-size: 24px;
    }

    .message-box p {
      font-family: 'Zen Maru Gothic', sans-serif;
      color: var(--dark-color);
      font-size: 16px;
      line-height: 1.8;
      margin-bottom: 20px;
    }

    /* ========== å›³é‘‘ç”»é¢ ========== */
    #zukan-screen {
      background:
        linear-gradient(180deg, #e0f7fa 0%, #f3e5f5 50%, #fff8e1 100%);
      position: relative;
    }

    #zukan-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('images/sample1.jpg');
      background-size: cover;
      background-position: center;
      opacity: 0.4;
      pointer-events: none;
      z-index: 0;
    }

    #zukan-screen > * {
      position: relative;
      z-index: 1;
    }

    .zukan-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .zukan-header h1 {
      color: var(--secondary-color);
      font-size: 28px;
      text-shadow: 2px 2px 0 white;
    }

    .zukan-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1200px;
    }

    .month-section {
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid var(--primary-color);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0, 188, 212, 0.2);
    }

    .month-section h3 {
      color: var(--secondary-color);
      font-size: 16px;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 2px solid var(--accent-color);
    }

    .month-cards {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .month-cards .card {
      width: 55px;
      height: 86px;
    }

    .back-button {
      margin-top: 30px;
      margin-bottom: 20px;
    }

    /* ========== ãƒ’ãƒ³ãƒˆè¡¨ç¤º ========== */
    .hint-btn {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--yellow-color), #ffb300);
      border: 2px solid white;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
      z-index: 50;
      transition: transform 0.2s, box-shadow 0.2s;
      color: var(--dark-color);
    }

    .hint-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 193, 7, 0.5);
    }

    /* ========== ã‚¿ãƒ¼ãƒ³è¡¨ç¤º ========== */
    .turn-indicator {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(180deg,
        var(--primary-light) 0%,
        var(--primary-color) 100%);
      color: white;
      padding: 8px 20px;
      border-radius: 25px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-weight: 700;
      font-size: 14px;
      animation: turnPulse 1.5s ease-in-out infinite;
      border: none;
      box-shadow: 0 3px 12px rgba(77, 208, 225, 0.4);
    }

    .turn-indicator.cpu-turn {
      background: linear-gradient(180deg,
        var(--accent-light) 0%,
        var(--accent-color) 100%);
      box-shadow: 0 3px 12px rgba(244, 143, 177, 0.4);
    }

    @keyframes turnPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* ========== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼‰ ========== */
    @media (max-width: 600px) {
      :root {
        --card-width: 45px;
        --card-height: 70px;
      }

      .title-logo {
        font-size: 36px;
        letter-spacing: 4px;
      }

      .title-subtitle {
        font-size: 16px;
      }

      .btn {
        padding: 14px 32px;
        font-size: 17px;
      }

      .btn-small {
        padding: 10px 22px;
        font-size: 14px;
      }

      .captured-cards .card {
        width: 28px;
        height: 44px;
      }

      .month-cards .card {
        width: 45px;
        height: 70px;
      }

      .message-box {
        padding: 25px 35px;
      }

      .message-box h2 {
        font-size: 20px;
      }

      .message-box p {
        font-size: 14px;
      }
    }

    /* ========== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼‰ ========== */
    @media (max-width: 480px) {
      :root {
        --card-width: 38px;
        --card-height: 59px;
      }

      body {
        font-size: 12px;
      }

      .screen {
        padding: 10px 5px;
      }

      /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
      .title-logo {
        font-size: 28px;
        letter-spacing: 2px;
      }

      .title-subtitle {
        font-size: 12px;
      }

      .title-character {
        max-width: 180px;
      }

      .title-cards img {
        width: 50px;
      }

      .btn {
        padding: 12px 24px;
        font-size: 15px;
        margin: 8px;
      }

      .btn-small {
        padding: 8px 16px;
        font-size: 12px;
      }

      /* ã‚²ãƒ¼ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ */
      .game-header {
        padding: 3px 5px;
        font-size: 11px;
      }

      .turn-indicator {
        font-size: 11px;
        padding: 4px 10px;
      }

      .deck-count {
        font-size: 10px;
        padding: 3px 8px;
      }

      .game-rule-hint {
        font-size: 10px;
        padding: 4px 10px;
      }

      /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ */
      .player-area {
        margin: 1px 0;
      }

      .area-label {
        font-size: 10px;
        padding: 2px 8px;
        margin-bottom: 2px;
      }

      .hand-count {
        font-size: 10px;
        padding: 1px 5px;
      }

      .cards-container {
        gap: 2px;
        padding: 3px 4px;
        min-height: 65px;
        border-radius: 6px;
      }

      .field-area .cards-container {
        min-height: 70px;
        border-width: 2px;
      }

      /* ã‚«ãƒ¼ãƒ‰ */
      .card {
        border-radius: 4px;
        border-width: 1px;
      }

      .card.selected {
        transform: translateY(-6px);
      }

      /* ã‚¿ãƒƒãƒ—æŒ‡ç¤º */
      .tap-label {
        font-size: 8px;
        padding: 2px 6px;
        bottom: -14px;
      }

      /* ç‚¹æ•°ãƒ‘ãƒãƒ« */
      .score-panel {
        top: 50px;
        right: 5px;
        padding: 8px;
        min-width: 90px;
        border-radius: 10px;
      }

      .score-panel h4 {
        font-size: 10px;
        margin-bottom: 4px;
      }

      .score-panel .score-row {
        font-size: 10px;
        margin: 2px 0;
      }

      .score-panel .score-value {
        font-size: 12px;
      }

      .score-panel .hint-text {
        font-size: 8px;
      }

      /* ç²å¾—æœ­ */
      .captured-area {
        margin-top: 3px;
      }

      .captured-section h5 {
        font-size: 9px;
      }

      .captured-cards .card {
        width: 22px;
        height: 34px;
        margin: -8px;
      }

      .month-cards .card {
        width: 38px;
        height: 59px;
      }

      /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ */
      .message-box {
        padding: 15px 20px;
        min-width: 260px;
        max-width: 90vw;
        border-radius: 15px;
      }

      .message-box h2 {
        font-size: 16px;
      }

      .message-box p {
        font-size: 12px;
      }

      .message-box .btn {
        padding: 10px 20px;
        font-size: 14px;
      }

      /* çµæœç”»é¢ */
      .result-title {
        font-size: 28px;
      }

      .result-message {
        font-size: 14px;
      }

      .score-display-row {
        font-size: 14px;
      }

      .final-score {
        font-size: 20px;
      }

      /* ã‚¬ã‚¤ãƒ‰ç”»é¢ */
      .guide-container {
        padding: 10px;
      }

      .guide-title {
        font-size: 20px;
      }

      .guide-tabs {
        gap: 3px;
      }

      .guide-tab {
        padding: 6px 10px;
        font-size: 11px;
      }

      .guide-content {
        padding: 10px;
        font-size: 12px;
      }

      .guide-content h3 {
        font-size: 14px;
      }

      .yaku-item {
        padding: 8px;
      }

      .yaku-name {
        font-size: 13px;
      }

      .yaku-desc {
        font-size: 10px;
      }
    }

    /* ========== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼ˆè¶…å°å‹ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼‰ ========== */
    @media (max-width: 360px) {
      :root {
        --card-width: 32px;
        --card-height: 50px;
      }

      .title-logo {
        font-size: 24px;
      }

      .btn {
        padding: 10px 18px;
        font-size: 13px;
      }

      .score-panel {
        min-width: 80px;
        padding: 6px;
      }

      .cards-container {
        gap: 1px;
        padding: 2px;
      }

      .captured-cards .card {
        width: 18px;
        height: 28px;
        margin: -10px;
      }
    }

    /* ========== ã‚¬ã‚¤ãƒ‰ç”»é¢ ========== */
    #guide-screen {
      background:
        linear-gradient(180deg, rgba(224, 247, 250, 0.9) 0%, rgba(243, 229, 245, 0.9) 50%, rgba(255, 248, 225, 0.9) 100%);
      position: relative;
    }

    #guide-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('images/sample2.png');
      background-size: cover;
      background-position: center;
      opacity: 0.4;
      pointer-events: none;
      z-index: 0;
    }

    #guide-screen > * {
      position: relative;
      z-index: 1;
    }

    .guide-container {
      width: 100%;
      max-width: 600px;
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid var(--primary-color);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 188, 212, 0.2);
      overflow: hidden;
      margin: 10px 0;
    }

    .guide-header {
      background: linear-gradient(135deg, var(--secondary-color), #7b1fa2);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .guide-header h2 {
      margin: 0;
      font-size: 24px;
    }

    .guide-tabs {
      display: flex;
      background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
      overflow-x: auto;
      padding: 8px;
      gap: 8px;
      border-radius: 20px 20px 0 0;
    }

    .guide-tab {
      flex: 1;
      min-width: 80px;
      padding: 12px 10px;
      border: none;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 15px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: #888;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .guide-tab.active {
      color: white;
      background: linear-gradient(180deg,
        var(--accent-light) 0%,
        var(--accent-color) 100%);
      box-shadow: 0 3px 12px rgba(244, 143, 177, 0.4);
    }

    .guide-tab:not(.active):hover {
      background: rgba(255, 255, 255, 0.9);
      color: var(--secondary-color);
    }

    .guide-content {
      padding: 25px;
      min-height: 400px;
      max-height: 60vh;
      overflow-y: auto;
      background: linear-gradient(180deg, #ffffff 0%, #fefefe 100%);
      font-family: 'Zen Maru Gothic', sans-serif;
    }

    .guide-page {
      display: none;
    }

    .guide-page.active {
      display: block;
    }

    .guide-page h3 {
      color: var(--secondary-color);
      border-bottom: 2px solid var(--accent-color);
      padding-bottom: 10px;
      margin-top: 0;
    }

    .guide-page p {
      line-height: 1.8;
      color: var(--dark-color);
      margin: 15px 0;
    }

    .guide-step {
      background: rgba(0, 188, 212, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid var(--primary-color);
    }

    .guide-step-number {
      display: inline-block;
      background: var(--primary-color);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      text-align: center;
      line-height: 28px;
      font-weight: bold;
      margin-right: 10px;
    }

    .guide-example {
      background: rgba(255, 193, 7, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border: 2px dashed var(--yellow-color);
    }

    .guide-example-title {
      font-weight: bold;
      color: #ff8f00;
      margin-bottom: 10px;
    }

    .guide-point {
      background: rgba(0, 188, 212, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid var(--primary-color);
    }

    .guide-point-title {
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    .guide-warning {
      background: rgba(255, 152, 0, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid #ff9800;
    }

    .guide-warning-title {
      font-weight: bold;
      color: #f57c00;
      margin-bottom: 10px;
    }

    .guide-rule {
      background: rgba(233, 30, 99, 0.1);
      border: 2px solid var(--accent-color);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
    }

    .guide-rule-title {
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .card-type-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
    }

    .card-type-item {
      display: flex;
      align-items: center;
      background: rgba(0, 188, 212, 0.1);
      border-radius: 8px;
      padding: 10px 15px;
      flex: 1;
      min-width: 120px;
      border: 1px solid rgba(0, 188, 212, 0.3);
    }

    .card-type-icon {
      font-size: 24px;
      margin-right: 10px;
    }

    .card-type-info {
      flex: 1;
    }

    .card-type-name {
      font-weight: bold;
      color: var(--dark-color);
    }

    .card-type-points {
      color: var(--accent-color);
      font-weight: bold;
    }

    .guide-footer {
      padding: 15px;
      text-align: center;
      border-top: 1px solid rgba(0, 188, 212, 0.3);
      background: rgba(0, 188, 212, 0.05);
    }
  </style>
</head>
<body>

  <!-- ========== ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ ========== -->
  <div id="title-screen" class="screen active">
    <h1 class="title-logo">ã™ã„ã¡ã‚ƒã‚“ã®èŠ±æœ­</h1>
    <p class="title-subtitle">ï½ Demon Hunters ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ï½</p>

    <img src="images/sample2.png" alt="Demon Hunters" class="title-character">

    <div class="title-cards">
      <img src="https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/Cherry0.jpeg" alt="æ¡œ">
      <img src="https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/Pine0.jpeg" alt="æ¾">
      <img src="https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/Grass0.jpeg" alt="æœˆ">
      <img src="https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/Paulownia0.jpeg" alt="æ¡">
    </div>

    <div class="menu-buttons">
      <button class="btn" onclick="startGame()">èŠ±æœ­ã‚’é–‹å§‹ã™ã‚‹</button>
      <button class="btn btn-secondary" onclick="showScreen('guide-screen')">éŠã³æ–¹</button>
      <button class="btn btn-small" onclick="showScreen('zukan-screen')">èŠ±æœ­å›³ã‹ã‚“</button>
    </div>
  </div>

  <!-- ========== ã‚²ãƒ¼ãƒ ç”»é¢ ========== -->
  <div id="game-screen" class="screen">
    <div class="game-header">
      <button class="btn btn-small" onclick="showScreen('title-screen')">ã‚‚ã©ã‚‹</button>
      <div class="turn-indicator" id="turn-indicator">ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³</div>
      <div class="score-display">
        <span id="player-score">0</span> - <span id="cpu-score">0</span>
      </div>
    </div>

    <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜ -->
    <div class="game-rule-hint">
      ğŸ´ æ‰‹æœ­ãŒ ãœã‚“ã¶ ãªããªã£ãŸã‚‰ ãŠã‚ã‚Šï¼ ãŸãã•ã‚“ ç‚¹ã‚’ ã¨ã‚ã†ï¼
    </div>

    <!-- CPUæ‰‹æœ­ -->
    <div class="player-area cpu-area">
      <div class="area-label">ç›¸æ‰‹ã® æ‰‹æœ­ <span id="cpu-hand-count" class="hand-count">(8æš)</span></div>
      <div class="cards-container" id="cpu-hand"></div>
    </div>

    <!-- å ´æœ­ -->
    <div class="player-area field-area">
      <div class="area-label">å ´</div>
      <div class="cards-container" id="field"></div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ æƒ…å ± -->
    <div class="game-info">
      <div class="deck-area">
        <div class="deck-card" id="deck" onclick="onDeckClick()"></div>
        <span id="deck-count">ã‚„ã¾ãµã : 24</span>
      </div>
    </div>

    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ‰‹æœ­ -->
    <div class="player-area player-area-bottom">
      <div class="area-label">ã‚ãªãŸã® æ‰‹æœ­ <span id="player-hand-count" class="hand-count">(8æš)</span></div>
      <div class="cards-container" id="player-hand"></div>
    </div>

    <!-- å–ã‚Šæœ­è¡¨ç¤º -->
    <div class="captured-area">
      <div class="captured-section player-captured">
        <h4>ã‚ãªãŸã® å–ã‚Šæœ­</h4>
        <div class="captured-cards" id="player-captured"></div>
      </div>
      <div class="captured-section cpu-captured">
        <h4>ç›¸æ‰‹ã® å–ã‚Šæœ­</h4>
        <div class="captured-cards" id="cpu-captured"></div>
      </div>
    </div>

    <button class="hint-btn" onclick="showHint()">?</button>
    <div class="drag-guide" id="drag-guide">å ´ã®åŒã˜æœˆã®æœ­ã«é‡ã­ã¦ã­ï¼</div>

    <!-- ç‚¹æ•°ãƒ‘ãƒãƒ« -->
    <div class="score-panel" id="score-panel">
      <h4>ç‚¹æ•°</h4>
      <div class="score-row player">
        <span>ã‚ãªãŸ</span>
        <span id="panel-player-score">0ç‚¹</span>
      </div>
      <div class="score-row cpu">
        <span>ç›¸æ‰‹</span>
        <span id="panel-cpu-score">0ç‚¹</span>
      </div>
      <div class="score-row difference" id="score-difference">
        <span id="diff-message">åŒç‚¹ï¼</span>
      </div>
    </div>

    <!-- CPUã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º -->
    <div class="cpu-action-overlay" id="cpu-action">
      <div class="action-icon" id="cpu-action-icon">ğŸ¤”</div>
      <div id="cpu-action-text">ã‚ã„ã¦ãŒ ã‹ã‚“ãŒãˆã¦ã‚‹ã‚ˆ...</div>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆ -->
    <div class="error-toast" id="error-toast">ã¡ãŒã†æœˆã ã‚ˆï¼</div>

    <!-- æƒ…å ±ãƒˆãƒ¼ã‚¹ãƒˆ -->
    <div class="info-toast" id="info-toast"></div>

    <!-- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
    <div class="animation-layer" id="animation-layer"></div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º -->
    <div class="step-display" id="step-display">
      <span class="step-icon" id="step-icon">ğŸ¤”</span>
      <div id="step-text">ç›¸æ‰‹ãŒè€ƒãˆã¦ã„ã¾ã™...</div>
      <div class="step-sub" id="step-sub"></div>
    </div>
  </div>

  <!-- ========== å›³é‘‘ç”»é¢ ========== -->
  <div id="zukan-screen" class="screen">
    <div class="zukan-header">
      <h1>èŠ±æœ­å›³ã‹ã‚“</h1>
      <p>å…¨éƒ¨ã§ 48æšã® æœ­ãŒã‚ã‚‹ã‚ˆï¼</p>
    </div>

    <div class="zukan-grid" id="zukan-grid"></div>

    <button class="btn back-button" onclick="showScreen('title-screen')">ã‚‚ã©ã‚‹</button>
  </div>

  <!-- ========== ã‚¬ã‚¤ãƒ‰ç”»é¢ ========== -->
  <div id="guide-screen" class="screen">
    <div class="guide-container">
      <div class="guide-header">
        <h2>ğŸ´ èŠ±æœ­ã®éŠã³æ–¹</h2>
      </div>

      <div class="guide-tabs">
        <button class="guide-tab active" onclick="showGuideTab(0)">åŸºæœ¬</button>
        <button class="guide-tab" onclick="showGuideTab(1)">ã‚¿ãƒ¼ãƒ³</button>
        <button class="guide-tab" onclick="showGuideTab(2)">æœ­ã®ç¨®é¡</button>
        <button class="guide-tab" onclick="showGuideTab(3)">å›°ã£ãŸæ™‚</button>
      </div>

      <div class="guide-content">
        <!-- åŸºæœ¬ãƒ«ãƒ¼ãƒ« -->
        <div class="guide-page active" id="guide-page-0">
          <h3>ğŸŒ¸ èŠ±æœ­ã£ã¦ ãªã«ï¼Ÿ</h3>
          <p>èŠ±æœ­ã¯ã€æ—¥æœ¬ã® å¤ã„ ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br>
          1æœˆã‹ã‚‰12æœˆã¾ã§ã€ãã‚Œãã‚Œã® æœˆã®èŠ±ãŒ æã‹ã‚ŒãŸ 48æšã® æœ­ã‚’ ä½¿ã„ã¾ã™ã€‚</p>

          <div class="guide-point">
            <div class="guide-point-title">ğŸ¯ ã‚²ãƒ¼ãƒ ã® ç›®çš„</div>
            <p>å ´ã«å‡ºã¦ã„ã‚‹ æœ­ã¨ åŒã˜æœˆã® æœ­ã‚’ åˆã‚ã›ã¦ã€<br>
            ã§ãã‚‹ã ã‘ å¤šãã® ç‚¹æ•°ã‚’ é›†ã‚ã‚ˆã†ï¼</p>
          </div>

          <h3>ğŸƒ ã‚²ãƒ¼ãƒ ã® å§‹ã¾ã‚Š</h3>
          <div class="guide-step">
            <span class="guide-step-number">1</span>
            ã‚ãªãŸã¨ ç›¸æ‰‹ã« 8æšãšã¤ æœ­ãŒ é…ã‚‰ã‚Œã‚‹
          </div>
          <div class="guide-step">
            <span class="guide-step-number">2</span>
            å ´ã« 8æšã® æœ­ãŒ ç½®ã‹ã‚Œã‚‹
          </div>
          <div class="guide-step">
            <span class="guide-step-number">3</span>
            æ®‹ã‚Šã® 24æšã¯ å±±æœ­ã«ãªã‚‹
          </div>

          <div class="guide-example">
            <div class="guide-example-title">ğŸ’¡ ã€ŒåŒã˜æœˆã€ã£ã¦ï¼Ÿ</div>
            <p>ä¾‹ãˆã°ã€Œ1æœˆã®æ¾ã€ã®æœ­ã¯ 4æšã‚ã‚Šã¾ã™ã€‚<br>
            ã“ã®4æšã¯ å…¨éƒ¨ã€ŒåŒã˜æœˆã€ãªã®ã§ã€<br>
            ã©ã‚Œã§ã‚‚ åˆã‚ã›ã‚‹ã“ã¨ãŒ ã§ãã¾ã™ï¼</p>
          </div>
        </div>

        <!-- ã‚¿ãƒ¼ãƒ³ã®æµã‚Œ -->
        <div class="guide-page" id="guide-page-1">
          <h3>ğŸ”„ ã‚¿ãƒ¼ãƒ³ã® æµã‚Œ</h3>
          <p>è‡ªåˆ†ã® ç•ªãŒ æ¥ãŸã‚‰ã€<strong>å¿…ãš2ã¤</strong>ã®ã“ã¨ã‚’ ã—ã¾ã™ã€‚</p>

          <div class="guide-step">
            <span class="guide-step-number">1</span>
            <strong>æ‰‹æœ­ã‹ã‚‰ 1æš å‡ºã™</strong>
          </div>

          <div class="guide-example">
            <div class="guide-example-title">âœ¨ å ´ã« åˆã†æœ­ãŒ ã‚ã‚‹ã¨ã</div>
            <p>åŒã˜æœˆã® æœ­ã¨ åˆã‚ã›ã¦ã€<br>
            <strong>2æšã¨ã‚‚ è‡ªåˆ†ã®ã‚‚ã®ã«ï¼</strong></p>
          </div>

          <div class="guide-rule">
            <div class="guide-rule-title">âš ï¸ å¤§äº‹ãª ãƒ«ãƒ¼ãƒ«ï¼</div>
            <p>å‡ºã—ãŸæœ­ã¨ <strong>åˆã†æœ­ãŒ ã‚ã£ãŸã‚‰<br>
            å¿…ãš åˆã‚ã›ãªã„ã¨ ãƒ€ãƒ¡</strong>ã ã‚ˆï¼<br><br>
            ğŸ’¡ åˆã‚ã›ãŸããªã„æ™‚ã¯...<br>
            <strong>åˆ¥ã® æ‰‹æœ­ã‚’ é¸ã¼ã†ï¼</strong></p>
          </div>

          <div class="guide-warning">
            <div class="guide-warning-title">ğŸ“¤ å ´ã« åˆã†æœ­ãŒ ãªã„ã¨ã</div>
            <p>å‡ºã—ãŸæœ­ã¯ <strong>å ´ã« ç½®ã„ãŸã¾ã¾</strong>ã«ãªã‚‹ã€‚<br>
            ï¼ˆç›¸æ‰‹ã« å–ã‚‰ã‚Œã‚‹ã‹ã‚‚...ï¼‰</p>
          </div>

          <div class="guide-step">
            <span class="guide-step-number">2</span>
            <strong>å±±æœ­ã‹ã‚‰ 1æš å¼•ã</strong>ï¼ˆå¿…ãšå¼•ãï¼ï¼‰
          </div>

          <div class="guide-example">
            <div class="guide-example-title">âœ¨ å ´ã« åˆã†æœ­ãŒ ã‚ã‚‹ã¨ã</div>
            <p>å¼•ã„ãŸæœ­ã¨ å ´ã®æœ­ã‚’ åˆã‚ã›ã¦ã€<br>
            <strong>2æšã¨ã‚‚ è‡ªåˆ†ã®ã‚‚ã®ã«ï¼</strong></p>
          </div>

          <div class="guide-warning">
            <div class="guide-warning-title">ğŸ“¤ å ´ã« åˆã†æœ­ãŒ ãªã„ã¨ã</div>
            <p>å¼•ã„ãŸæœ­ã‚‚ <strong>å ´ã« ç½®ã</strong>ã“ã¨ã«ãªã‚‹ã€‚</p>
          </div>

          <div class="guide-point">
            <div class="guide-point-title">ğŸ’¡ ã¤ã¾ã‚Š...</div>
            <p>1ã‚¿ãƒ¼ãƒ³ã§ æœ€å¤§ <strong>4æš</strong> å–ã‚Œã‚‹ï¼<br>
            ï¼ˆæ‰‹æœ­ã§2æš + å±±æœ­ã§2æšï¼‰<br><br>
            ã§ã‚‚ åˆã†æœ­ãŒ ãªã‘ã‚Œã°<br>
            å ´ã« <strong>2æš å¢—ãˆã‚‹</strong>ã“ã¨ã‚‚...</p>
          </div>

          <div class="guide-point">
            <div class="guide-point-title">ğŸ” ã“ã‚Œã‚’ ãã‚Šè¿”ã™</div>
            <p>ãŠäº’ã„ã« æ‰‹æœ­ãŒ ãªããªã‚‹ã¾ã§<br>
            äº¤äº’ã« ã‚¿ãƒ¼ãƒ³ã‚’ ç¶šã‘ã¾ã™ã€‚<br>
            æœ€å¾Œã« ç‚¹æ•°ãŒ å¤šã„æ–¹ãŒ å‹ã¡ï¼</p>
          </div>
        </div>

        <!-- æœ­ã®ç¨®é¡ -->
        <div class="guide-page" id="guide-page-2">
          <h3>ğŸ† æœ­ã® ç¨®é¡ã¨ ç‚¹æ•°</h3>
          <p>æœ­ã«ã¯ 4ã¤ã® ç¨®é¡ãŒ ã‚ã‚Šã¾ã™ã€‚<br>
          ç‚¹æ•°ãŒ é«˜ã„æœ­ã‚’ é›†ã‚ã‚ˆã†ï¼</p>

          <div class="card-type-list">
            <div class="card-type-item">
              <div class="card-type-icon">ğŸŒŸ</div>
              <div class="card-type-info">
                <div class="card-type-name">å…‰ï¼ˆã²ã‹ã‚Šï¼‰</div>
                <div class="card-type-points">20ç‚¹</div>
              </div>
            </div>
            <div class="card-type-item">
              <div class="card-type-icon">ğŸ¦¢</div>
              <div class="card-type-info">
                <div class="card-type-name">ç¨®ï¼ˆãŸã­ï¼‰</div>
                <div class="card-type-points">10ç‚¹</div>
              </div>
            </div>
          </div>

          <div class="card-type-list">
            <div class="card-type-item">
              <div class="card-type-icon">ğŸ“œ</div>
              <div class="card-type-info">
                <div class="card-type-name">çŸ­å†Šï¼ˆãŸã‚“ã–ãï¼‰</div>
                <div class="card-type-points">5ç‚¹</div>
              </div>
            </div>
            <div class="card-type-item">
              <div class="card-type-icon">ğŸƒ</div>
              <div class="card-type-info">
                <div class="card-type-name">ã‚«ã‚¹</div>
                <div class="card-type-points">1ç‚¹</div>
              </div>
            </div>
          </div>

          <div class="guide-example">
            <div class="guide-example-title">ğŸŒŸ å…‰ã®æœ­ï¼ˆ5æšã—ã‹ ãªã„ï¼ï¼‰</div>
            <p>ãƒ»1æœˆã€Œæ¾ã«é¶´ã€<br>
            ãƒ»3æœˆã€Œæ¡œã«å¹•ã€<br>
            ãƒ»8æœˆã€ŒèŠ’ã«æœˆã€<br>
            ãƒ»11æœˆã€ŒæŸ³ã«å°é‡é“é¢¨ã€<br>
            ãƒ»12æœˆã€Œæ¡ã«é³³å‡°ã€</p>
          </div>

          <div class="guide-point">
            <div class="guide-point-title">ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ</div>
            <p>å…‰ã‚„ ç¨®ã® æœ­ã¯ ç‚¹æ•°ãŒ é«˜ã„ã®ã§ã€<br>
            ãªã‚‹ã¹ã å–ã‚ŠãŸã„ï¼<br>
            ã§ã‚‚ ã‚«ã‚¹ã‚‚ ãŸãã•ã‚“ é›†ã‚ã‚Œã°<br>
            ç‚¹æ•°ã« ãªã‚‹ã‚ˆï¼</p>
          </div>
        </div>

        <!-- å›°ã£ãŸæ™‚ -->
        <div class="guide-page" id="guide-page-3">
          <h3>â“ å›°ã£ãŸæ™‚ã¯ï¼Ÿ</h3>

          <div class="guide-warning">
            <div class="guide-warning-title">Q: åˆã†æœ­ãŒ 2æšä»¥ä¸Š ã‚ã‚‹ã¨ãï¼Ÿ</div>
            <p>å¥½ããªæ–¹ã‚’ é¸ã‚“ã§ ã‚¿ãƒƒãƒ—ã™ã‚Œã° OKï¼<br>
            ç‚¹æ•°ãŒ é«˜ã„æ–¹ã‚’ é¸ã¶ã®ãŒ ãŠã™ã™ã‚ã€‚</p>
          </div>

          <div class="guide-warning">
            <div class="guide-warning-title">Q: æ‰‹æœ­ã« åˆã†æœ­ãŒ 1æšã‚‚ ãªã„ã¨ãï¼Ÿ</div>
            <p>ä»•æ–¹ãªã„ã®ã§ã€ã©ã‚Œã‹ 1æš å ´ã« å‡ºãã†ã€‚<br>
            ã‚«ã‚¹ãªã© ç‚¹æ•°ãŒ ä½ã„æœ­ã‚’<br>
            å‡ºã™ã®ãŒ ã„ã„ã‹ã‚‚ï¼</p>
          </div>

          <div class="guide-warning">
            <div class="guide-warning-title">Q: ã©ã®æœ­ã‚’ å‡ºã›ã° ã„ã„ã‹ ã‚ã‹ã‚‰ãªã„ï¼Ÿ</div>
            <p>ã‚²ãƒ¼ãƒ ä¸­ã«ã€Œãƒ’ãƒ³ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ æŠ¼ã™ã¨ã€<br>
            ãŠã™ã™ã‚ã® æ‰‹ã‚’ æ•™ãˆã¦ãã‚Œã‚‹ã‚ˆï¼</p>
          </div>

          <div class="guide-point">
            <div class="guide-point-title">ğŸ® æ“ä½œæ–¹æ³•</div>
            <p>ãƒ»æ‰‹æœ­ã‚’ é•·æŠ¼ã—ã—ã¦ ãƒ‰ãƒ©ãƒƒã‚°<br>
            ãƒ»å ´ã® åˆã†æœ­ã« é‡ã­ã‚‹<br>
            ãƒ»ã¾ãŸã¯ ã‚¿ãƒƒãƒ—ã—ã¦ é¸æŠ</p>
          </div>

          <div class="guide-example">
            <div class="guide-example-title">ğŸ ã‚²ãƒ¼ãƒ çµ‚äº†</div>
            <p>ãŠäº’ã„ã® æ‰‹æœ­ãŒ ãªããªã£ãŸã‚‰ çµ‚äº†ï¼<br>
            <span style="color: #FFD700; font-size: 12px;">ï¼ˆå±±æœ­ãŒ æ®‹ã£ã¦ã„ã¦ã‚‚ çµ‚ã‚ã‚Šã ã‚ˆï¼‰</span><br>
            å–ã£ãŸæœ­ã® ç‚¹æ•°ã‚’ åˆè¨ˆã—ã¦ã€<br>
            å¤šã„æ–¹ãŒ å‹ã¡ï¼</p>
          </div>
        </div>
      </div>

      <div class="guide-footer">
        <button class="btn" onclick="showScreen('title-screen')">ã‚‚ã©ã‚‹</button>
        <button class="btn btn-secondary" onclick="startGame()">éŠã‚“ã§ã¿ã‚‹ï¼</button>
      </div>
    </div>
  </div>

  <!-- ========== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ========== -->
  <div class="message-overlay" id="message-overlay">
    <div class="message-box">
      <h2 id="message-title">ã‚¿ã‚¤ãƒˆãƒ«</h2>
      <p id="message-text">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</p>
      <button class="btn" id="message-btn" onclick="closeMessage()">OK</button>
    </div>
  </div>

  <script>
    // ========== å®šæ•°ãƒ»è¨­å®š ========== //
    const IMAGE_BASE = 'https://raw.githubusercontent.com/teradaian/hanafuda/main/assets/tiles/';

    // ========== èŠ±æœ­ãƒ‡ãƒ¼ã‚¿ï¼ˆ48æšï¼‰ ========== //
    const CARDS = [
      // 1æœˆ æ¾
      { id: 1, month: 1, flower: 'æ¾', name: 'æ¾ã«é¶´', type: 'hikari', points: 20, image: 'Pine0.jpeg' },
      { id: 2, month: 1, flower: 'æ¾', name: 'æ¾ã®èµ¤çŸ­', type: 'tanzaku', points: 5, image: 'Pine1.jpeg' },
      { id: 3, month: 1, flower: 'æ¾', name: 'æ¾ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Pine2.jpeg' },
      { id: 4, month: 1, flower: 'æ¾', name: 'æ¾ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Pine3.jpeg' },

      // 2æœˆ æ¢…
      { id: 5, month: 2, flower: 'æ¢…', name: 'æ¢…ã«é¶¯', type: 'tane', points: 10, image: 'Plum0.jpeg' },
      { id: 6, month: 2, flower: 'æ¢…', name: 'æ¢…ã®èµ¤çŸ­', type: 'tanzaku', points: 5, image: 'Plum1.jpeg' },
      { id: 7, month: 2, flower: 'æ¢…', name: 'æ¢…ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Plum2.jpeg' },
      { id: 8, month: 2, flower: 'æ¢…', name: 'æ¢…ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Plum3.jpeg' },

      // 3æœˆ æ¡œ
      { id: 9, month: 3, flower: 'æ¡œ', name: 'æ¡œã«å¹•', type: 'hikari', points: 20, image: 'Cherry0.jpeg' },
      { id: 10, month: 3, flower: 'æ¡œ', name: 'æ¡œã®èµ¤çŸ­', type: 'tanzaku', points: 5, image: 'Cherry1.jpeg' },
      { id: 11, month: 3, flower: 'æ¡œ', name: 'æ¡œã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Cherry2.jpeg' },
      { id: 12, month: 3, flower: 'æ¡œ', name: 'æ¡œã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Cherry3.jpeg' },

      // 4æœˆ è—¤
      { id: 13, month: 4, flower: 'è—¤', name: 'è—¤ã«ä¸å¦‚å¸°', type: 'tane', points: 10, image: 'Wisteria0.jpeg' },
      { id: 14, month: 4, flower: 'è—¤', name: 'è—¤ã®çŸ­å†Š', type: 'tanzaku', points: 5, image: 'Wisteria1.jpeg' },
      { id: 15, month: 4, flower: 'è—¤', name: 'è—¤ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Wisteria2.jpeg' },
      { id: 16, month: 4, flower: 'è—¤', name: 'è—¤ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Wisteria3.jpeg' },

      // 5æœˆ è–è’²
      { id: 17, month: 5, flower: 'è–è’²', name: 'è–è’²ã«å…«æ©‹', type: 'tane', points: 10, image: 'Iris0.jpeg' },
      { id: 18, month: 5, flower: 'è–è’²', name: 'è–è’²ã®çŸ­å†Š', type: 'tanzaku', points: 5, image: 'Iris1.jpeg' },
      { id: 19, month: 5, flower: 'è–è’²', name: 'è–è’²ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Iris2.jpeg' },
      { id: 20, month: 5, flower: 'è–è’²', name: 'è–è’²ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Iris3.jpeg' },

      // 6æœˆ ç‰¡ä¸¹
      { id: 21, month: 6, flower: 'ç‰¡ä¸¹', name: 'ç‰¡ä¸¹ã«è¶', type: 'tane', points: 10, image: 'Peony0.jpeg' },
      { id: 22, month: 6, flower: 'ç‰¡ä¸¹', name: 'ç‰¡ä¸¹ã®é’çŸ­', type: 'tanzaku', points: 5, image: 'Peony1.jpeg' },
      { id: 23, month: 6, flower: 'ç‰¡ä¸¹', name: 'ç‰¡ä¸¹ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Peony2.jpeg' },
      { id: 24, month: 6, flower: 'ç‰¡ä¸¹', name: 'ç‰¡ä¸¹ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Peony3.jpeg' },

      // 7æœˆ è©
      { id: 25, month: 7, flower: 'è©', name: 'è©ã«çŒª', type: 'tane', points: 10, image: 'Clover0.jpeg' },
      { id: 26, month: 7, flower: 'è©', name: 'è©ã®çŸ­å†Š', type: 'tanzaku', points: 5, image: 'Clover1.jpeg' },
      { id: 27, month: 7, flower: 'è©', name: 'è©ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Clover2.jpeg' },
      { id: 28, month: 7, flower: 'è©', name: 'è©ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Clover3.jpeg' },

      // 8æœˆ èŠ’
      { id: 29, month: 8, flower: 'èŠ’', name: 'èŠ’ã«æœˆ', type: 'hikari', points: 20, image: 'Grass0.jpeg' },
      { id: 30, month: 8, flower: 'èŠ’', name: 'èŠ’ã«é›', type: 'tane', points: 10, image: 'Grass1.jpeg' },
      { id: 31, month: 8, flower: 'èŠ’', name: 'èŠ’ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Grass2.jpeg' },
      { id: 32, month: 8, flower: 'èŠ’', name: 'èŠ’ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Grass3.jpeg' },

      // 9æœˆ èŠ
      { id: 33, month: 9, flower: 'èŠ', name: 'èŠã«ç›ƒ', type: 'tane', points: 10, image: 'Chrysanthemum0.jpeg' },
      { id: 34, month: 9, flower: 'èŠ', name: 'èŠã®é’çŸ­', type: 'tanzaku', points: 5, image: 'Chrysanthemum1.jpeg' },
      { id: 35, month: 9, flower: 'èŠ', name: 'èŠã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Chrysanthemum2.jpeg' },
      { id: 36, month: 9, flower: 'èŠ', name: 'èŠã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Chrysanthemum3.jpeg' },

      // 10æœˆ ç´…è‘‰
      { id: 37, month: 10, flower: 'ç´…è‘‰', name: 'ç´…è‘‰ã«é¹¿', type: 'tane', points: 10, image: 'Maple0.jpeg' },
      { id: 38, month: 10, flower: 'ç´…è‘‰', name: 'ç´…è‘‰ã®é’çŸ­', type: 'tanzaku', points: 5, image: 'Maple1.jpeg' },
      { id: 39, month: 10, flower: 'ç´…è‘‰', name: 'ç´…è‘‰ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Maple2.jpeg' },
      { id: 40, month: 10, flower: 'ç´…è‘‰', name: 'ç´…è‘‰ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Maple3.jpeg' },

      // 11æœˆ æŸ³
      { id: 41, month: 11, flower: 'æŸ³', name: 'æŸ³ã«å°é‡é“é¢¨', type: 'hikari', points: 20, image: 'Willow0.jpeg' },
      { id: 42, month: 11, flower: 'æŸ³', name: 'æŸ³ã«ç‡•', type: 'tane', points: 10, image: 'Willow1.jpeg' },
      { id: 43, month: 11, flower: 'æŸ³', name: 'æŸ³ã®çŸ­å†Š', type: 'tanzaku', points: 5, image: 'Willow2.jpeg' },
      { id: 44, month: 11, flower: 'æŸ³', name: 'æŸ³ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Willow3.jpeg' },

      // 12æœˆ æ¡
      { id: 45, month: 12, flower: 'æ¡', name: 'æ¡ã«é³³å‡°', type: 'hikari', points: 20, image: 'Paulownia0.jpeg' },
      { id: 46, month: 12, flower: 'æ¡', name: 'æ¡ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Paulownia1.jpeg' },
      { id: 47, month: 12, flower: 'æ¡', name: 'æ¡ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Paulownia2.jpeg' },
      { id: 48, month: 12, flower: 'æ¡', name: 'æ¡ã®ã‚«ã‚¹', type: 'kasu', points: 1, image: 'Paulownia3.jpeg' },
    ];

    const MONTH_NAMES = ['', '1æœˆ æ¾', '2æœˆ æ¢…', '3æœˆ æ¡œ', '4æœˆ è—¤', '5æœˆ è–è’²', '6æœˆ ç‰¡ä¸¹',
                         '7æœˆ è©', '8æœˆ èŠ’', '9æœˆ èŠ', '10æœˆ ç´…è‘‰', '11æœˆ æŸ³', '12æœˆ æ¡'];

    // ========== ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ========== //
    let gameState = {
      deck: [],
      field: [],
      playerHand: [],
      cpuHand: [],
      playerCaptured: [],
      cpuCaptured: [],
      playerScore: 0,
      cpuScore: 0,
      currentTurn: 'player',
      selectedCard: null,
      phase: 'select-hand', // 'select-hand', 'select-field', 'draw', 'cpu-turn'
      isFromDeck: false, // å±±æœ­ã‹ã‚‰å¼•ã„ãŸã‚«ãƒ¼ãƒ‰ã§é¸æŠä¸­ã‹ã©ã†ã‹
    };

    // ========== ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—çŠ¶æ…‹ ========== //
    let dragState = {
      isDragging: false,
      dragCard: null,
      dragElement: null,
      ghostElement: null,
      startX: 0,
      startY: 0,
      offsetX: 0,
      offsetY: 0,
      longPressTimer: null,
      isLongPress: false
    };

    // ========== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ========== //
    function shuffle(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function getCardImageUrl(card) {
      return IMAGE_BASE + card.image;
    }

    function createCardElement(card, faceDown = false) {
      const div = document.createElement('div');
      div.className = 'card' + (faceDown ? ' face-down' : '');
      div.dataset.cardId = card.id;

      const img = document.createElement('img');
      img.src = faceDown ? IMAGE_BASE + 'back.jpeg' : getCardImageUrl(card);
      img.alt = card.name;
      img.draggable = false;

      div.appendChild(img);
      return div;
    }

    function getCardById(cardId) {
      return CARDS.find(c => c.id === parseInt(cardId));
    }

    // ========== ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ========== //
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');

      if (screenId === 'zukan-screen') {
        renderZukan();
      }
    }

    // ========== å›³é‘‘è¡¨ç¤º ========== //
    function renderZukan() {
      const grid = document.getElementById('zukan-grid');
      grid.innerHTML = '';

      for (let month = 1; month <= 12; month++) {
        const monthCards = CARDS.filter(c => c.month === month);
        const section = document.createElement('div');
        section.className = 'month-section';

        section.innerHTML = `<h3>${MONTH_NAMES[month]}</h3>`;

        const cardsDiv = document.createElement('div');
        cardsDiv.className = 'month-cards';

        monthCards.forEach(card => {
          const cardEl = createCardElement(card);
          cardEl.title = `${card.name} (${card.points}ç‚¹)`;
          cardsDiv.appendChild(cardEl);
        });

        section.appendChild(cardsDiv);
        grid.appendChild(section);
      }
    }

    // ========== ã‚²ãƒ¼ãƒ é–‹å§‹ ========== //
    function startGame() {
      gameState = {
        deck: [],
        field: [],
        playerHand: [],
        cpuHand: [],
        playerCaptured: [],
        cpuCaptured: [],
        playerScore: 0,
        cpuScore: 0,
        currentTurn: 'player',
        selectedCard: null,
        phase: 'select-hand',
        isFromDeck: false,
      };

      // ãƒ‡ãƒƒã‚­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦é…ã‚‹
      gameState.deck = shuffle([...CARDS]);

      // æ‰‹æœ­ã‚’8æšãšã¤é…ã‚‹
      for (let i = 0; i < 8; i++) {
        gameState.playerHand.push(gameState.deck.pop());
        gameState.cpuHand.push(gameState.deck.pop());
      }

      // å ´æœ­ã‚’8æšé…ã‚‹
      for (let i = 0; i < 8; i++) {
        gameState.field.push(gameState.deck.pop());
      }

      showScreen('game-screen');
      renderGame();
      updateTurnIndicator();

      // åˆå›ã‚¬ã‚¤ãƒ‰è¡¨ç¤º
      setTimeout(() => {
        showMessage('ğŸ´ ã‚²ãƒ¼ãƒ é–‹å§‹ï¼', 'æ‰‹æœ­ã‚’ é•·æŠ¼ã—ã—ã¦ ãƒ‰ãƒ©ãƒƒã‚°ï¼\nå ´ã® åŒã˜æœˆã®æœ­ã« é‡ã­ã¦ã­ï¼\n\nãŒã‚“ã°ã£ã¦ï¼');
      }, 500);
    }

    // ========== ã‚²ãƒ¼ãƒ æç”» ========== //
    function renderGame() {
      renderHand('player-hand', gameState.playerHand, false, true);
      renderHand('cpu-hand', gameState.cpuHand, true, false);
      renderField();
      renderCaptured();
      updateDeckCount();
      updateHandCounts();
      updateScores();
    }

    function renderHand(containerId, hand, faceDown, enableDrag) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      hand.forEach(card => {
        const cardEl = createCardElement(card, faceDown);

        if (enableDrag && gameState.currentTurn === 'player' && gameState.phase === 'select-hand') {
          cardEl.classList.add('touchable');
          setupDragEvents(cardEl, card);
        }

        if (gameState.selectedCard && gameState.selectedCard.id === card.id) {
          cardEl.classList.add('selected');
        }

        container.appendChild(cardEl);
      });
    }

    function renderField() {
      const container = document.getElementById('field');
      container.innerHTML = '';

      // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã‹ã©ã†ã‹ã§å ´ã®ã‚¨ãƒªã‚¢ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’åˆ¶å¾¡
      let hasMatchingCard = false;

      gameState.field.forEach(card => {
        const cardEl = createCardElement(card);
        cardEl.dataset.fieldCard = 'true';

        // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®å ´åˆã€ãƒãƒƒãƒãƒ³ã‚°å¯¾è±¡ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        if (dragState.isDragging && dragState.dragCard) {
          if (card.month === dragState.dragCard.month) {
            cardEl.classList.add('drop-target');
            hasMatchingCard = true;
          }
        }

        // select-field ãƒ•ã‚§ãƒ¼ã‚ºã®å ´åˆï¼ˆå±±æœ­ã‹ã‚‰å¼•ã„ãŸæ™‚ãªã©ï¼‰
        if (gameState.phase === 'select-field' && gameState.selectedCard) {
          if (card.month === gameState.selectedCard.month) {
            cardEl.classList.add('drop-target');
            cardEl.onclick = () => matchWithField(card);
          }
        }

        container.appendChild(cardEl);
      });

      // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã‚¯ãƒªã‚¢
      container.classList.remove('drop-zone-active');
    }

    function renderCaptured() {
      const playerContainer = document.getElementById('player-captured');
      const cpuContainer = document.getElementById('cpu-captured');

      playerContainer.innerHTML = '';
      cpuContainer.innerHTML = '';

      gameState.playerCaptured.forEach(card => {
        const cardEl = createCardElement(card);
        addPointBadge(cardEl, card);
        playerContainer.appendChild(cardEl);
      });

      gameState.cpuCaptured.forEach(card => {
        const cardEl = createCardElement(card);
        addPointBadge(cardEl, card);
        cpuContainer.appendChild(cardEl);
      });
    }

    // ç‚¹æ•°ãƒãƒƒã‚¸ã‚’è¿½åŠ 
    function addPointBadge(cardEl, card) {
      const badge = document.createElement('span');
      badge.className = 'point-badge';
      if (card.points >= 10) {
        badge.classList.add('high-point');
      }
      badge.textContent = card.points;
      cardEl.appendChild(badge);
    }

    function updateDeckCount() {
      document.getElementById('deck-count').textContent = `å±±æœ­: ${gameState.deck.length}`;
    }

    function updateHandCounts() {
      const playerCount = gameState.playerHand.length;
      const cpuCount = gameState.cpuHand.length;

      const playerEl = document.getElementById('player-hand-count');
      const cpuEl = document.getElementById('cpu-hand-count');

      playerEl.textContent = `(${playerCount}æš)`;
      cpuEl.textContent = `(${cpuCount}æš)`;

      // æ®‹ã‚Šå°‘ãªããªã£ãŸã‚‰è­¦å‘Šè‰²ã«
      if (playerCount <= 2 && playerCount > 0) {
        playerEl.classList.add('last-cards');
      } else {
        playerEl.classList.remove('last-cards');
      }

      if (cpuCount <= 2 && cpuCount > 0) {
        cpuEl.classList.add('last-cards');
      } else {
        cpuEl.classList.remove('last-cards');
      }
    }

    function updateScores() {
      const playerScore = gameState.playerCaptured.reduce((sum, c) => sum + c.points, 0);
      const cpuScore = gameState.cpuCaptured.reduce((sum, c) => sum + c.points, 0);

      document.getElementById('player-score').textContent = playerScore;
      document.getElementById('cpu-score').textContent = cpuScore;

      // è©³ç´°ãƒ‘ãƒãƒ«æ›´æ–°
      document.getElementById('panel-player-score').textContent = playerScore + 'ç‚¹';
      document.getElementById('panel-cpu-score').textContent = cpuScore + 'ç‚¹';

      // å·®åˆ†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      const diff = playerScore - cpuScore;
      const diffEl = document.getElementById('score-difference');
      const diffMsg = document.getElementById('diff-message');

      if (diff > 0) {
        diffEl.className = 'score-row difference winning';
        diffMsg.textContent = `${diff}ç‚¹ å‹ã£ã¦ã‚‹ã‚ˆï¼`;
      } else if (diff < 0) {
        diffEl.className = 'score-row difference losing';
        diffMsg.textContent = `ã‚ã¨ ${Math.abs(diff) + 1}ç‚¹ã§ é€†è»¢ï¼`;
      } else {
        diffEl.className = 'score-row difference tie';
        diffMsg.textContent = 'åŒç‚¹ï¼';
      }

      gameState.playerScore = playerScore;
      gameState.cpuScore = cpuScore;
    }

    function updateTurnIndicator() {
      const indicator = document.getElementById('turn-indicator');
      if (gameState.currentTurn === 'player') {
        indicator.textContent = 'ã‚ãªãŸã®ç•ª';
        indicator.classList.remove('cpu-turn');
      } else {
        indicator.textContent = 'ç›¸æ‰‹ã®ç•ª';
        indicator.classList.add('cpu-turn');
      }
    }

    // ========== ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç† ========== //
    function setupDragEvents(cardEl, card) {
      // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
      cardEl.addEventListener('touchstart', (e) => handleDragStart(e, cardEl, card), { passive: false });
      cardEl.addEventListener('touchmove', (e) => handleDragMove(e), { passive: false });
      cardEl.addEventListener('touchend', (e) => handleDragEnd(e), { passive: false });
      cardEl.addEventListener('touchcancel', (e) => handleDragEnd(e), { passive: false });

      // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆPCå¯¾å¿œï¼‰
      cardEl.addEventListener('mousedown', (e) => handleDragStart(e, cardEl, card));
    }

    function handleDragStart(e, cardEl, card) {
      if (gameState.phase !== 'select-hand' || gameState.currentTurn !== 'player') return;

      e.preventDefault();
      const touch = e.touches ? e.touches[0] : e;

      dragState.startX = touch.clientX;
      dragState.startY = touch.clientY;
      dragState.dragCard = card;
      dragState.dragElement = cardEl;
      dragState.isLongPress = false;

      // é•·æŠ¼ã—æ¤œå‡ºï¼ˆ150msï¼‰
      dragState.longPressTimer = setTimeout(() => {
        startDragging(touch.clientX, touch.clientY, cardEl, card);
      }, 150);

      // ãƒã‚¦ã‚¹ã®å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
      if (!e.touches) {
        document.addEventListener('mousemove', handleDragMove);
        document.addEventListener('mouseup', handleDragEnd);
      }
    }

    function startDragging(clientX, clientY, cardEl, card) {
      dragState.isDragging = true;
      dragState.isLongPress = true;

      // å…ƒã®ã‚«ãƒ¼ãƒ‰ã‚’åŠé€æ˜ã«
      cardEl.classList.add('drag-source');

      // ã‚´ãƒ¼ã‚¹ãƒˆè¦ç´ ã‚’ä½œæˆ
      const rect = cardEl.getBoundingClientRect();
      dragState.offsetX = clientX - rect.left;
      dragState.offsetY = clientY - rect.top;

      const ghost = cardEl.cloneNode(true);
      ghost.classList.add('drag-ghost', 'dragging');
      ghost.style.width = rect.width + 'px';
      ghost.style.height = rect.height + 'px';
      ghost.style.left = (clientX - dragState.offsetX) + 'px';
      ghost.style.top = (clientY - dragState.offsetY) + 'px';
      document.body.appendChild(ghost);
      dragState.ghostElement = ghost;

      // åˆã†æœ­ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const matchingCards = gameState.field.filter(c => c.month === card.month);
      const guideEl = document.getElementById('drag-guide');

      if (matchingCards.length > 0) {
        // åˆã†æœ­ãŒã‚ã‚‹ â†’ ç·‘ã®ã‚¬ã‚¤ãƒ‰ï¼ˆå¿…ãšåˆã‚ã›ã‚‹å¿…è¦ã‚ã‚Šï¼‰
        const matchNames = matchingCards.map(c => `ã€Œ${c.flower}ã€`).join(' ã‹ ');
        guideEl.innerHTML = `ğŸ¯ ã“ã®æœ­ã¯<br>${matchNames}<br>ã¨ åˆã‚ã›ã¦ã­ï¼`;
        guideEl.classList.remove('no-match');
      } else {
        // åˆã†æœ­ãŒãªã„ â†’ ã‚ªãƒ¬ãƒ³ã‚¸ã®ã‚¬ã‚¤ãƒ‰ï¼ˆå ´ã«ç½®ã‘ã‚‹ï¼‰
        guideEl.innerHTML = `ğŸ“¤ åˆã†æœ­ãŒ ãªã„ã‚ˆ<br>å ´ã« ç½®ã„ã¦ã­ï¼`;
        guideEl.classList.add('no-match');
      }
      guideEl.classList.add('active');

      // å ´ã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      renderField();

      // ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¯¾å¿œãƒ‡ãƒã‚¤ã‚¹ã®ã¿ï¼‰
      if (navigator.vibrate) {
        navigator.vibrate(30);
      }
    }

    function handleDragMove(e) {
      if (!dragState.isDragging && dragState.longPressTimer) {
        // é•·æŠ¼ã—ä¸­ã«å‹•ã„ãŸã‚‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        const touch = e.touches ? e.touches[0] : e;
        const dx = touch.clientX - dragState.startX;
        const dy = touch.clientY - dragState.startY;
        if (Math.abs(dx) > 10 || Math.abs(dy) > 10) {
          clearTimeout(dragState.longPressTimer);
          dragState.longPressTimer = null;
          // å³åº§ã«ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
          if (dragState.dragElement && dragState.dragCard) {
            startDragging(touch.clientX, touch.clientY, dragState.dragElement, dragState.dragCard);
          }
        }
      }

      if (!dragState.isDragging) return;
      e.preventDefault();

      const touch = e.touches ? e.touches[0] : e;
      if (dragState.ghostElement) {
        dragState.ghostElement.style.left = (touch.clientX - dragState.offsetX) + 'px';
        dragState.ghostElement.style.top = (touch.clientY - dragState.offsetY) + 'px';
      }
    }

    function handleDragEnd(e) {
      clearTimeout(dragState.longPressTimer);
      dragState.longPressTimer = null;

      // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
      document.removeEventListener('mousemove', handleDragMove);
      document.removeEventListener('mouseup', handleDragEnd);

      if (!dragState.isDragging) {
        resetDragState();
        return;
      }

      const touch = e.changedTouches ? e.changedTouches[0] : e;

      // ãƒ‰ãƒ­ãƒƒãƒ—å…ˆã‚’æ¤œå‡º
      if (dragState.ghostElement) {
        dragState.ghostElement.style.display = 'none';
      }
      const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
      if (dragState.ghostElement) {
        dragState.ghostElement.style.display = '';
      }

      // å ´ã«åˆã†æœ­ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const matchingFieldCards = gameState.field.filter(c => c.month === dragState.dragCard?.month);

      // å ´ã®ã‚«ãƒ¼ãƒ‰ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
      const fieldCard = dropTarget?.closest('.card[data-field-card="true"]');

      if (fieldCard && dragState.dragCard) {
        const targetCardId = parseInt(fieldCard.dataset.cardId);
        const targetCard = gameState.field.find(c => c.id === targetCardId);

        if (targetCard && targetCard.month === dragState.dragCard.month) {
          // ãƒãƒƒãƒæˆåŠŸï¼
          showMatchSuccess(dragState.dragCard, targetCard);
          captureCards('player', dragState.dragCard, targetCard);
          cleanupDrag();
          return;
        } else if (targetCard) {
          // æœˆãŒé•ã†ï¼ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã—ã¦æˆ»ã™
          showErrorToast(`é•ã†æœˆã ã‚ˆï¼\nã€Œ${dragState.dragCard.flower}ã€ã¯ã€Œ${targetCard.flower}ã€ã¨ åˆã‚ãªã„ã‚ˆ`);
          cleanupDrag();
          renderGame();
          return;
        }
      }

      // å ´ã®ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
      const fieldArea = dropTarget?.closest('.field-area');
      const fieldContainer = dropTarget?.closest('#field');

      if ((fieldArea || fieldContainer) && dragState.dragCard) {
        // å ´ã®ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸ

        if (matchingFieldCards.length > 0) {
          // å ´ã«åˆã†æœ­ãŒã‚ã‚‹ã®ã«å ´ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸ â†’ åˆã‚ã›ãªã„ã¨ãƒ€ãƒ¡ï¼
          const matchNames = matchingFieldCards.map(c => `ã€Œ${c.flower}ã€`).join('ã€');
          showErrorToast(`ã“ã®æœ­ã¯ ${matchNames}ã¨\nåˆã‚ã›ãªã„ã¨ ãƒ€ãƒ¡ã ã‚ˆï¼\nåˆ¥ã®æœ­ã‚’ é¸ã‚“ã§ã­`);
          cleanupDrag();
          renderGame();
          return;
        } else {
          // å ´ã«åˆã†æœ­ãŒãªã„ â†’ å ´ã«å‡ºã›ã‚‹
          gameState.playerHand = gameState.playerHand.filter(c => c.id !== dragState.dragCard.id);
          gameState.field.push(dragState.dragCard);
          cleanupDrag();
          gameState.phase = 'draw';
          renderGame();
          updateDeckClickable();
          showMessage('å ´ã« å‡ºã—ãŸã‚ˆ', `ã€Œ${dragState.dragCard.flower}ã€ã‚’ å ´ã« ç½®ã„ãŸã‚ˆ\næ¬¡ã¯ å±±æœ­ã‚’ ã‚¿ãƒƒãƒ—ã—ã¦ å¼•ã„ã¦ã­ï¼`);
          return;
        }
      }

      // ãã‚Œä»¥å¤–ã®å ´æ‰€ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸ â†’ ã‚«ãƒ¼ãƒ‰ã‚’æˆ»ã™
      if (matchingFieldCards.length > 0) {
        // å ´ã«åˆã†æœ­ãŒã‚ã‚‹å ´åˆã¯ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤º
        const matchNames = matchingFieldCards.map(c => `ã€Œ${c.flower}ã€`).join('ã€');
        showErrorToast(`ã“ã®æœ­ã¯ ${matchNames}ã¨\nåˆã‚ã›ã¦ã­ï¼\nåˆã‚ã›ãŸããªã„ãªã‚‰\nåˆ¥ã®æœ­ã‚’ é¸ã‚“ã§ã­`);
      }
      // ã‚«ãƒ¼ãƒ‰ã‚’æ‰‹æœ­ã«æˆ»ã™ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰
      cleanupDrag();
      renderGame();
    }

    // ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
    function showErrorToast(message) {
      const toast = document.getElementById('error-toast');
      toast.textContent = message;
      toast.classList.add('active');

      // ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
      if (navigator.vibrate) {
        navigator.vibrate([100, 50, 100]);
      }

      setTimeout(() => {
        toast.classList.remove('active');
      }, 2000);
    }

    // æƒ…å ±ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºï¼ˆè‡ªå‹•ã§æ¶ˆãˆã‚‹ï¼‰
    function showInfoToast(message) {
      const toast = document.getElementById('info-toast');
      toast.innerHTML = message.replace(/\n/g, '<br>');
      toast.classList.add('active');

      setTimeout(() => {
        toast.classList.remove('active');
      }, 2500);
    }

    // ãƒãƒƒãƒæˆåŠŸè¡¨ç¤º
    function showMatchSuccess(handCard, fieldCard) {
      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ captureCards ã§è¡¨ç¤ºã™ã‚‹ã®ã§ã€ã“ã“ã§ã¯ä½•ã‚‚ã—ãªã„
      // ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã“ã“ã«ï¼‰
    }

    function cleanupDrag() {
      if (dragState.ghostElement) {
        dragState.ghostElement.remove();
      }
      if (dragState.dragElement) {
        dragState.dragElement.classList.remove('drag-source');
      }
      const guideEl = document.getElementById('drag-guide');
      guideEl.classList.remove('active', 'no-match');
      resetDragState();
    }

    function resetDragState() {
      dragState = {
        isDragging: false,
        dragCard: null,
        dragElement: null,
        ghostElement: null,
        startX: 0,
        startY: 0,
        offsetX: 0,
        offsetY: 0,
        longPressTimer: null,
        isLongPress: false
      };
    }

    // ========== ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³ï¼ˆå±±æœ­é¸æŠæ™‚ç”¨ï¼‰ ========== //
    function matchWithField(fieldCard) {
      if (gameState.phase !== 'select-field') return;
      if (!gameState.selectedCard) return;

      const selectedCard = gameState.selectedCard;
      const isFromDeck = gameState.isFromDeck;
      const points = selectedCard.points + fieldCard.points;

      // å–ã‚Šæœ­ã«è¿½åŠ 
      if (!isFromDeck) {
        // æ‰‹æœ­ã‹ã‚‰å‡ºã—ãŸå ´åˆã¯æ‰‹æœ­ã‹ã‚‰å‰Šé™¤
        gameState.playerHand = gameState.playerHand.filter(c => c.id !== selectedCard.id);
      }
      gameState.field = gameState.field.filter(c => c.id !== fieldCard.id);
      gameState.playerCaptured.push(selectedCard, fieldCard);

      // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
      gameState.selectedCard = null;
      gameState.isFromDeck = false;

      if (isFromDeck) {
        // å±±æœ­ã‹ã‚‰å¼•ã„ãŸå ´åˆ â†’ ã‚¿ãƒ¼ãƒ³çµ‚äº†
        renderGame();
        showMessage('âœ¨ å–ã‚ŒãŸã‚ˆï¼', `ã€Œ${selectedCard.name}ã€ã¨ã€Œ${fieldCard.name}ã€\nã‚²ãƒƒãƒˆï¼ +${points}ç‚¹`, () => endTurn('player'));
      } else {
        // æ‰‹æœ­ã‹ã‚‰å‡ºã—ãŸå ´åˆ â†’ å±±æœ­ã‚’å¼•ããƒ•ã‚§ãƒ¼ã‚ºã¸
        gameState.phase = 'draw';
        renderGame();
        updateDeckClickable();
        showMessage('âœ¨ å–ã‚ŒãŸã‚ˆï¼', `ã€Œ${selectedCard.name}ã€ã¨ã€Œ${fieldCard.name}ã€\nã‚²ãƒƒãƒˆï¼ +${points}ç‚¹\n\næ¬¡ã¯ å±±æœ­ã‚’ ã‚¿ãƒƒãƒ—ã—ã¦ã­ï¼`);
      }
    }

    function captureCards(player, handCard, fieldCard) {
      if (player === 'player') {
        gameState.playerHand = gameState.playerHand.filter(c => c.id !== handCard.id);
        gameState.field = gameState.field.filter(c => c.id !== fieldCard.id);
        gameState.playerCaptured.push(handCard, fieldCard);
      } else {
        gameState.cpuHand = gameState.cpuHand.filter(c => c.id !== handCard.id);
        gameState.field = gameState.field.filter(c => c.id !== fieldCard.id);
        gameState.cpuCaptured.push(handCard, fieldCard);
      }

      gameState.selectedCard = null;
      gameState.isFromDeck = false;
      gameState.phase = 'draw';
      renderGame();

      if (player === 'player') {
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å±±æœ­ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å¼•ã
        const points = handCard.points + fieldCard.points;
        updateDeckClickable();
        showMessage('âœ¨ å–ã‚ŒãŸã‚ˆï¼', `ã€Œ${handCard.name}ã€ã¨ã€Œ${fieldCard.name}ã€\nã‚²ãƒƒãƒˆï¼ +${points}ç‚¹\n\næ¬¡ã¯ å±±æœ­ã‚’ ã‚¿ãƒƒãƒ—ã—ã¦ã­ï¼`);
      } else {
        setTimeout(() => drawFromDeck(player), 500);
      }
    }

    // å±±æœ­ã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹
    function updateDeckClickable() {
      const deckEl = document.getElementById('deck');
      if (gameState.phase === 'draw' && gameState.currentTurn === 'player') {
        deckEl.classList.add('clickable');
      } else {
        deckEl.classList.remove('clickable');
      }
    }

    // å±±æœ­ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
    function onDeckClick() {
      if (gameState.phase !== 'draw' || gameState.currentTurn !== 'player') {
        return;
      }

      // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½çŠ¶æ…‹ã‚’è§£é™¤
      document.getElementById('deck').classList.remove('clickable');

      // å±±æœ­ã‹ã‚‰å¼•ãï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
      drawFromDeckAnimated('player');
    }

    function drawFromDeck(player) {
      // å±±æœ­ã®ã‚¯ãƒªãƒƒã‚¯å¯èƒ½çŠ¶æ…‹ã‚’è§£é™¤
      document.getElementById('deck').classList.remove('clickable');

      if (gameState.deck.length === 0) {
        endTurn(player);
        return;
      }

      const drawnCard = gameState.deck.pop();
      const matchingCards = gameState.field.filter(c => c.month === drawnCard.month);

      if (matchingCards.length === 0) {
        // ãƒãƒƒãƒãªã—ï¼šå ´ã«ç½®ã
        gameState.field.push(drawnCard);
        renderGame();
        showMessage('å±±æœ­ã‹ã‚‰å¼•ã„ãŸ', `ã€Œ${drawnCard.name}ã€\nå ´ã« åˆã†æœ­ãŒ ãªã„ã‹ã‚‰ ç½®ã„ãŸã‚ˆ`, () => endTurn(player));
      } else if (matchingCards.length === 1) {
        // 1æšãƒãƒƒãƒ
        const matchCard = matchingCards[0];
        gameState.playerCaptured.push(drawnCard, matchCard);
        gameState.field = gameState.field.filter(c => c.id !== matchCard.id);
        renderGame();
        const points = drawnCard.points + matchCard.points;
        showMessage('ğŸ‰ ãƒ©ãƒƒã‚­ãƒ¼ï¼', `å±±æœ­ã‹ã‚‰ã€Œ${drawnCard.name}ã€ï¼\nã€Œ${matchCard.name}ã€ã¨ åˆã£ãŸï¼ +${points}ç‚¹`, () => endTurn(player));
      } else {
        // è¤‡æ•°ãƒãƒƒãƒ
        gameState.selectedCard = drawnCard;
        gameState.isFromDeck = true;
        gameState.phase = 'select-field';
        renderGame();
        showMessage('é¸ã‚“ã§ã­', `å±±æœ­ã‹ã‚‰ã€Œ${drawnCard.name}ã€ï¼\nå ´ã® ã©ã®æœ­ã¨ åˆã‚ã›ã‚‹ï¼Ÿ\nã‚¿ãƒƒãƒ—ã—ã¦ é¸ã‚“ã§ã­`);
      }
    }

    function endTurn(player) {
      if (gameState.playerHand.length === 0 && gameState.cpuHand.length === 0) {
        setTimeout(endGame, 1000);
        return;
      }

      if (player === 'player') {
        gameState.currentTurn = 'cpu';
        gameState.phase = 'cpu-turn';
        updateTurnIndicator();
        // CPUã®ã‚¿ãƒ¼ãƒ³ã‚’é–‹å§‹ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã—ï¼‰
        setTimeout(cpuTurn, 500);
      } else {
        gameState.currentTurn = 'player';
        gameState.phase = 'select-hand';
        updateTurnIndicator();
        renderGame();
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³é–‹å§‹ã‚’çŸ¥ã‚‰ã›ã‚‹
        showMessage('ã‚ãªãŸã®ç•ªï¼', 'æ‰‹æœ­ã‚’ é•·æŠ¼ã—ã—ã¦ ãƒ‰ãƒ©ãƒƒã‚°ï¼\nå ´ã® åŒã˜æœˆã®æœ­ã« é‡ã­ã¦ã­');
      }
    }

    // ========== å¼·åŒ–ç‰ˆCPU AI ========== //

    // ã‚«ãƒ¼ãƒ‰ã®ä¾¡å€¤ã‚’è©•ä¾¡ï¼ˆå½¹ã®å¯èƒ½æ€§ã‚‚è€ƒæ…®ï¼‰
    function evaluateCardValue(card, captured) {
      let value = card.points;

      // å…‰æœ­ã¯æœ€é«˜ä¾¡å€¤
      if (card.type === 'hikari') {
        value += 50;
        // æ—¢ã«å…‰ã‚’æŒã£ã¦ã„ãŸã‚‰ãƒœãƒ¼ãƒŠã‚¹
        const hikariCount = captured.filter(c => c.type === 'hikari').length;
        if (hikariCount >= 1) value += 30;
        if (hikariCount >= 2) value += 50;
      }

      // çŒªé¹¿è¶ã®å½¹
      if ([25, 21, 37].includes(card.id)) { // è©ã«çŒªã€ç‰¡ä¸¹ã«è¶ã€ç´…è‘‰ã«é¹¿
        const inoShikaCho = [25, 21, 37];
        const hasCount = captured.filter(c => inoShikaCho.includes(c.id)).length;
        if (hasCount >= 1) value += 25;
        if (hasCount >= 2) value += 50;
      }

      // èµ¤çŸ­ãƒ»é’çŸ­ã®å½¹
      if (card.type === 'tanzaku') {
        const akaTan = [2, 6, 10]; // æ¾æ¢…æ¡œã®èµ¤çŸ­
        const aoTan = [22, 34, 38]; // ç‰¡ä¸¹èŠç´…è‘‰ã®é’çŸ­

        if (akaTan.includes(card.id)) {
          const hasAka = captured.filter(c => akaTan.includes(c.id)).length;
          if (hasAka >= 1) value += 20;
          if (hasAka >= 2) value += 40;
        }

        if (aoTan.includes(card.id)) {
          const hasAo = captured.filter(c => aoTan.includes(c.id)).length;
          if (hasAo >= 1) value += 20;
          if (hasAo >= 2) value += 40;
        }

        value += 15; // çŸ­å†Šã¯åŸºæœ¬çš„ã«ä¾¡å€¤ãŒé«˜ã„
      }

      // ç¨®æœ­
      if (card.type === 'tane') {
        const taneCount = captured.filter(c => c.type === 'tane').length;
        if (taneCount >= 4) value += 15; // ã‚¿ãƒå½¹ã«è¿‘ã¥ã„ã¦ã„ã‚‹
        value += 10;
      }

      return value;
    }

    // è¤‡æ•°ãƒãƒƒãƒæ™‚ã«æœ€é©ãªå ´æœ­ã‚’é¸æŠ
    function cpuSelectBestFieldCard(matchingCards) {
      let bestCard = matchingCards[0];
      let bestValue = evaluateCardValue(bestCard, gameState.cpuCaptured);

      for (const card of matchingCards) {
        const value = evaluateCardValue(card, gameState.cpuCaptured);
        if (value > bestValue) {
          bestValue = value;
          bestCard = card;
        }
      }

      return bestCard;
    }

    // ========== ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•° ========== //

    // ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºï¼ˆå¤§ããªèª¬æ˜æ–‡ï¼‰
    function showStep(icon, text, subText = '', duration = 2000) {
      return new Promise(resolve => {
        const display = document.getElementById('step-display');
        document.getElementById('step-icon').textContent = icon;
        document.getElementById('step-text').textContent = text;
        document.getElementById('step-sub').textContent = subText;
        display.classList.add('active');

        setTimeout(() => {
          display.classList.remove('active');
          setTimeout(resolve, 400);
        }, duration);
      });
    }

    // å¾…æ©Ÿï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
    function wait(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // ã‚«ãƒ¼ãƒ‰è¦ç´ ã®ä½ç½®ã‚’å–å¾—
    function getCardPosition(cardId, containerId) {
      const container = document.getElementById(containerId);
      const cardEl = container?.querySelector(`[data-card-id="${cardId}"]`);
      if (cardEl) {
        const rect = cardEl.getBoundingClientRect();
        return { x: rect.left, y: rect.top, width: rect.width, height: rect.height };
      }
      return null;
    }

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
    function createAnimatedCard(card, startX, startY, faceDown = false) {
      const animCard = document.createElement('div');
      animCard.className = 'animated-card';
      animCard.style.left = startX + 'px';
      animCard.style.top = startY + 'px';

      const img = document.createElement('img');
      img.src = faceDown ? IMAGE_BASE + 'back.jpeg' : getCardImageUrl(card);
      img.alt = card.name;
      animCard.appendChild(img);

      document.getElementById('animation-layer').appendChild(animCard);
      return animCard;
    }

    // ã‚«ãƒ¼ãƒ‰ã‚’ç§»å‹•ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function animateCardMove(animCard, endX, endY, duration = 800) {
      return new Promise(resolve => {
        animCard.style.transition = `all ${duration}ms ease-in-out`;
        animCard.style.left = endX + 'px';
        animCard.style.top = endY + 'px';
        setTimeout(resolve, duration);
      });
    }

    // ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function animateCardFlip(animCard, card) {
      return new Promise(resolve => {
        animCard.classList.add('flipping');
        setTimeout(() => {
          animCard.querySelector('img').src = getCardImageUrl(card);
        }, 300);
        setTimeout(() => {
          animCard.classList.remove('flipping');
          resolve();
        }, 600);
      });
    }

    // ã‚«ãƒ¼ãƒ‰ã®ãƒãƒƒãƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function animateCardMatch(animCard) {
      return new Promise(resolve => {
        animCard.classList.add('matched');
        setTimeout(() => {
          animCard.classList.remove('matched');
          resolve();
        }, 800);
      });
    }

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤
    function removeAnimatedCard(animCard) {
      if (animCard && animCard.parentNode) {
        animCard.remove();
      }
    }

    // å…¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢
    function clearAnimationLayer() {
      document.getElementById('animation-layer').innerHTML = '';
    }

    // CPUã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºï¼ˆæ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»äº’æ›ç”¨ï¼‰
    function showCpuAction(icon, text, duration = 1500) {
      return new Promise(resolve => {
        const overlay = document.getElementById('cpu-action');
        document.getElementById('cpu-action-icon').textContent = icon;
        document.getElementById('cpu-action-text').textContent = text;
        overlay.classList.add('active');

        setTimeout(() => {
          overlay.classList.remove('active');
          setTimeout(resolve, 300);
        }, duration);
      });
    }

    // CPUã®ã‚¿ãƒ¼ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç‰ˆï¼‰
    async function cpuTurn() {
      if (gameState.cpuHand.length === 0) {
        endTurn('cpu');
        return;
      }

      // å…¨ã¦ã®æ‰‹æœ­ã¨å ´ã®çµ„ã¿åˆã‚ã›ã‚’è©•ä¾¡
      let bestPlay = null;
      let bestScore = -Infinity;

      for (const handCard of gameState.cpuHand) {
        const matches = gameState.field.filter(c => c.month === handCard.month);

        if (matches.length > 0) {
          for (const fieldCard of matches) {
            const handValue = evaluateCardValue(handCard, gameState.cpuCaptured);
            const fieldValue = evaluateCardValue(fieldCard, gameState.cpuCaptured);
            const totalValue = handValue + fieldValue;
            const playerWantValue = evaluateCardValue(fieldCard, gameState.playerCaptured);
            const score = totalValue + (playerWantValue * 0.3);

            if (score > bestScore) {
              bestScore = score;
              bestPlay = { handCard, fieldCard };
            }
          }
        }
      }

      if (bestPlay) {
        await cpuPlayMatchAnimation(bestPlay.handCard, bestPlay.fieldCard);
      } else {
        let worstCard = null;
        let worstValue = Infinity;

        for (const handCard of gameState.cpuHand) {
          const deckRemaining = gameState.deck.filter(c => c.month === handCard.month).length;
          let value = evaluateCardValue(handCard, gameState.cpuCaptured);
          if (deckRemaining > 0) value += 5;

          if (value < worstValue) {
            worstValue = value;
            worstCard = handCard;
          }
        }

        if (worstCard) {
          await cpuPlayNoMatchAnimation(worstCard);
        }
      }
    }

    // CPUãŒãƒãƒƒãƒã™ã‚‹å ´åˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
    async function cpuPlayMatchAnimation(handCard, fieldCard) {
      // æ‰‹æœ­ã®ä½ç½®ã‚’å–å¾—
      const cpuArea = document.getElementById('cpu-hand').getBoundingClientRect();
      const startX = cpuArea.left + cpuArea.width / 2 - 35;
      const startY = cpuArea.top + 10;

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ä½œæˆï¼ˆè£å‘ãï¼‰
      const animCard = createAnimatedCard(handCard, startX, startY, true);
      await wait(1200);

      // æœ­ã‚’ã‚ãã‚‹
      await animateCardFlip(animCard, handCard);
      await wait(1800);

      // å ´ã®æœ­ã«å‘ã‹ã£ã¦ç§»å‹•
      const fieldPos = getCardPosition(fieldCard.id, 'field');
      if (fieldPos) {
        await animateCardMove(animCard, fieldPos.x, fieldPos.y, 1500);
      }
      await wait(1000);

      // ãƒãƒƒãƒã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      await animateCardMatch(animCard);
      await wait(1200);

      // èª¬æ˜ãªã— - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§è¦‹ã›ã‚‹
      removeAnimatedCard(animCard);

      // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
      gameState.cpuHand = gameState.cpuHand.filter(c => c.id !== handCard.id);
      gameState.field = gameState.field.filter(c => c.id !== fieldCard.id);
      gameState.cpuCaptured.push(handCard, fieldCard);
      gameState.phase = 'draw';
      renderGame();

      await wait(1500);
      await drawFromDeckAnimated('cpu');
    }

    // CPUãŒãƒãƒƒãƒã§ããªã„å ´åˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
    async function cpuPlayNoMatchAnimation(card) {
      // æ‰‹æœ­ã®ä½ç½®ã‚’å–å¾—
      const cpuArea = document.getElementById('cpu-hand').getBoundingClientRect();
      const startX = cpuArea.left + cpuArea.width / 2 - 35;
      const startY = cpuArea.top + 10;

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ä½œæˆï¼ˆè£å‘ãï¼‰
      const animCard = createAnimatedCard(card, startX, startY, true);
      await wait(1200);

      // æœ­ã‚’ã‚ãã‚‹
      await animateCardFlip(animCard, card);
      await wait(1800);

      // å ´ã«ç½®ã
      const fieldArea = document.getElementById('field').getBoundingClientRect();
      const endX = fieldArea.left + fieldArea.width / 2 - 35;
      const endY = fieldArea.top + 20;

      await animateCardMove(animCard, endX, endY, 1500);
      await wait(1200);

      // èª¬æ˜ãªã— - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§è¦‹ã›ã‚‹
      removeAnimatedCard(animCard);
      gameState.cpuHand = gameState.cpuHand.filter(c => c.id !== card.id);
      gameState.field.push(card);
      gameState.phase = 'draw';
      renderGame();

      await wait(1500);
      await drawFromDeckAnimated('cpu');
    }

    // å±±æœ­ã‹ã‚‰å¼•ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
    async function drawFromDeckAnimated(player) {
      if (gameState.deck.length === 0) {
        endTurn(player);
        return;
      }

      const drawnCard = gameState.deck.pop();
      const matchingCards = gameState.field.filter(c => c.month === drawnCard.month);

      // å±±æœ­ã®ä½ç½®
      const deckEl = document.getElementById('deck').getBoundingClientRect();
      const startX = deckEl.left;
      const startY = deckEl.top;

      if (player === 'cpu') {
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ä½œæˆï¼ˆè£å‘ãï¼‰
        const animCard = createAnimatedCard(drawnCard, startX, startY, true);
        await wait(1000);

        // ä¸­å¤®ã«ç§»å‹•
        const centerX = window.innerWidth / 2 - 35;
        const centerY = window.innerHeight / 2 - 55;
        await animateCardMove(animCard, centerX, centerY, 1200);
        await wait(800);

        // ã‚ãã‚‹
        await animateCardFlip(animCard, drawnCard);
        await wait(2000);

        if (matchingCards.length === 0) {
          // ãƒãƒƒãƒãªã— - å ´ã®ä¸€ç•ªå³å´ã«ç½®ã
          const fieldContainer = document.getElementById('field');
          const fieldRect = fieldContainer.getBoundingClientRect();
          const fieldCards = fieldContainer.querySelectorAll('.card');
          let targetX;
          if (fieldCards.length > 0) {
            const lastCard = fieldCards[fieldCards.length - 1];
            const lastCardRect = lastCard.getBoundingClientRect();
            targetX = lastCardRect.right + 10;
          } else {
            targetX = fieldRect.left + 10;
          }
          const targetY = fieldRect.top + (fieldRect.height / 2) - 55;

          await animateCardMove(animCard, targetX, targetY, 1200);
          await wait(1000);

          // èª¬æ˜ãªã— - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§è¦‹ã›ã‚‹
          removeAnimatedCard(animCard);
          gameState.field.push(drawnCard);
          renderGame();
          await wait(1500);
          endTurn(player);

        } else if (matchingCards.length === 1) {
          // 1æšãƒãƒƒãƒ
          const matchCard = matchingCards[0];
          const matchPos = getCardPosition(matchCard.id, 'field');

          if (matchPos) {
            await animateCardMove(animCard, matchPos.x, matchPos.y, 1200);
          }
          await animateCardMatch(animCard);
          await wait(1200);

          // èª¬æ˜ãªã— - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§è¦‹ã›ã‚‹
          removeAnimatedCard(animCard);
          gameState.cpuCaptured.push(drawnCard, matchCard);
          gameState.field = gameState.field.filter(c => c.id !== matchCard.id);
          renderGame();
          await wait(1500);
          endTurn(player);

        } else {
          // è¤‡æ•°ãƒãƒƒãƒ
          const bestMatch = cpuSelectBestFieldCard(matchingCards);
          const matchPos = getCardPosition(bestMatch.id, 'field');

          if (matchPos) {
            await animateCardMove(animCard, matchPos.x, matchPos.y, 1200);
          }
          await animateCardMatch(animCard);
          await wait(1200);

          // èª¬æ˜ãªã— - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§è¦‹ã›ã‚‹
          removeAnimatedCard(animCard);
          gameState.cpuCaptured.push(drawnCard, bestMatch);
          gameState.field = gameState.field.filter(c => c.id !== bestMatch.id);
          renderGame();
          await wait(1500);
          endTurn(player);
        }

      } else {
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å ´åˆ - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã
        updateDeckCount();

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ä½œæˆï¼ˆè£å‘ãã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰
        const animCard = createAnimatedCard(drawnCard, startX, startY, true);
        await wait(500);

        // ä¸­å¤®ã«ç§»å‹•
        const centerX = window.innerWidth / 2 - 35;
        const centerY = window.innerHeight / 2 - 55;
        await animateCardMove(animCard, centerX, centerY, 800);
        await wait(400);

        // ã‚ãã£ã¦è¡¨ã‚’è¦‹ã›ã‚‹
        await animateCardFlip(animCard, drawnCard);
        await wait(1500);

        if (matchingCards.length === 0) {
          // ãƒãƒƒãƒãªã— - ã¾ãšãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
          showInfoToast(`åˆã†æœ­ãŒ ãªã„ã‚ˆ...\nå ´ã« ç½®ãã­`);
          await wait(2800);

          // å ´ã®ä¸€ç•ªå³å´ã«ç§»å‹•ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          const fieldContainer = document.getElementById('field');
          const fieldRect = fieldContainer.getBoundingClientRect();
          const fieldCards = fieldContainer.querySelectorAll('.card');
          let targetX;
          if (fieldCards.length > 0) {
            // æ—¢å­˜ã®ã‚«ãƒ¼ãƒ‰ã®å³å´ã«é…ç½®
            const lastCard = fieldCards[fieldCards.length - 1];
            const lastCardRect = lastCard.getBoundingClientRect();
            targetX = lastCardRect.right + 10;
          } else {
            // ã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯å·¦ç«¯ã‹ã‚‰
            targetX = fieldRect.left + 10;
          }
          const targetY = fieldRect.top + (fieldRect.height / 2) - 55;

          await animateCardMove(animCard, targetX, targetY, 1000);
          await wait(500);

          removeAnimatedCard(animCard);
          gameState.field.push(drawnCard);
          renderGame();
          await wait(500);
          endTurn(player);

        } else if (matchingCards.length === 1) {
          // 1æšãƒãƒƒãƒ - åˆã‚ã›ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          const matchCard = matchingCards[0];
          const matchPos = getCardPosition(matchCard.id, 'field');

          if (matchPos) {
            await animateCardMove(animCard, matchPos.x, matchPos.y, 800);
          }
          await animateCardMatch(animCard);
          await wait(800);

          removeAnimatedCard(animCard);
          gameState.playerCaptured.push(drawnCard, matchCard);
          gameState.field = gameState.field.filter(c => c.id !== matchCard.id);
          renderGame();
          const points = drawnCard.points + matchCard.points;
          showMessage('ğŸ‰ ãƒ©ãƒƒã‚­ãƒ¼ï¼', `ã€Œ${drawnCard.name}ã€ã¨\nã€Œ${matchCard.name}ã€ãŒ åˆã£ãŸï¼\n+${points}ç‚¹`, () => endTurn(player));

        } else {
          // è¤‡æ•°ãƒãƒƒãƒ - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé¸ã¶
          removeAnimatedCard(animCard);
          gameState.selectedCard = drawnCard;
          gameState.isFromDeck = true;
          gameState.phase = 'select-field';
          renderGame();
          showMessage('é¸ã‚“ã§ã­', `ã€Œ${drawnCard.name}ã€ã‚’ å¼•ã„ãŸã‚ˆï¼\nå ´ã® ã©ã®æœ­ã¨ åˆã‚ã›ã‚‹ï¼Ÿ\nå…‰ã£ã¦ã„ã‚‹æœ­ã‚’ ã‚¿ãƒƒãƒ—ã—ã¦ã­`);
        }
      }
    }


    // ========== ã‚²ãƒ¼ãƒ çµ‚äº† ========== //
    function endGame() {
      const playerScore = gameState.playerScore;
      const cpuScore = gameState.cpuScore;
      const diff = Math.abs(playerScore - cpuScore);

      let title, message;
      if (playerScore > cpuScore) {
        title = 'ğŸ‰ ã‚„ã£ãŸã­ï¼å‹ã¡ï¼';
        message = `ã‚ãªãŸ ${playerScore}ç‚¹ vs ç›¸æ‰‹ ${cpuScore}ç‚¹\n${diff}ç‚¹å·®ã§ å‹ã£ãŸã‚ˆï¼`;
      } else if (playerScore < cpuScore) {
        title = 'ğŸ˜¢ æ®‹å¿µ...è² ã‘...';
        message = `ã‚ãªãŸ ${playerScore}ç‚¹ vs ç›¸æ‰‹ ${cpuScore}ç‚¹\n${diff}ç‚¹å·®ã§ è² ã‘ã¡ã‚ƒã£ãŸ...`;
      } else {
        title = 'ğŸ¤ å¼•ãåˆ†ã‘ï¼';
        message = `ã‚ãªãŸ ${playerScore}ç‚¹ vs ç›¸æ‰‹ ${cpuScore}ç‚¹\nåŒã˜ç‚¹æ•°ã ã£ãŸã­ï¼`;
      }

      showMessage(title, message, () => showScreen('title-screen'));
    }

    // ========== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º ========== //
    function showMessage(title, text, callback = null) {
      document.getElementById('message-title').textContent = title;
      document.getElementById('message-text').textContent = text;
      document.getElementById('message-overlay').classList.add('active');

      const btn = document.getElementById('message-btn');
      btn.onclick = () => {
        closeMessage();
        if (callback) callback();
      };
      // OKãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§æ¶ˆãˆãªã„
    }

    function closeMessage() {
      document.getElementById('message-overlay').classList.remove('active');
    }

    // ========== ãƒ˜ãƒ«ãƒ—ãƒ»ãƒ’ãƒ³ãƒˆ ========== //
    function showGuideTab(tabIndex) {
      // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
      const tabs = document.querySelectorAll('.guide-tab');
      const pages = document.querySelectorAll('.guide-page');

      tabs.forEach((tab, i) => {
        tab.classList.toggle('active', i === tabIndex);
      });

      pages.forEach((page, i) => {
        page.classList.toggle('active', i === tabIndex);
      });
    }

    function showHowToPlay() {
      // æ—§é–¢æ•°äº’æ›ç”¨ - ã‚¬ã‚¤ãƒ‰ç”»é¢ã¸
      showScreen('guide-screen');
    }

    function showHint() {
      if (gameState.phase !== 'select-hand') {
        showMessage('ãƒ’ãƒ³ãƒˆ', 'ã¡ã‚‡ã£ã¨ å¾…ã£ã¦ã­ï¼');
        return;
      }

      const hints = [];
      for (const handCard of gameState.playerHand) {
        const matches = gameState.field.filter(c => c.month === handCard.month);
        if (matches.length > 0) {
          const bestMatch = matches.reduce((a, b) => a.points > b.points ? a : b);
          hints.push({
            text: `ã€Œ${handCard.flower}ã€ã‚’ å ´ã®ã€Œ${bestMatch.flower}ã€ã«ï¼\n+${handCard.points + bestMatch.points}ç‚¹`,
            score: handCard.points + bestMatch.points
          });
        }
      }

      if (hints.length > 0) {
        hints.sort((a, b) => b.score - a.score);
        showMessage('ğŸ’¡ ãƒ’ãƒ³ãƒˆ', hints[0].text);
      } else {
        showMessage('ğŸ’¡ ãƒ’ãƒ³ãƒˆ', 'åˆã‚ã›ã‚‰ã‚Œã‚‹æœ­ãŒ ãªã„ã‚ˆ...\nå¥½ããªæœ­ã‚’ ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦\nå ´ã« å‡ºã—ã¦ã­');
      }
    }

    // ========== åˆæœŸåŒ– ========== //
    window.onload = function() {
      console.log('ã™ã„ã¡ã‚ƒã‚“ã®èŠ±æœ­ v3.8 - CPUãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ç‰ˆ');

      // iOSã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
      document.addEventListener('touchmove', function(e) {
        if (dragState.isDragging) {
          e.preventDefault();
        }
      }, { passive: false });

      // Service Workerç™»éŒ²ï¼ˆPWAã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js')
          .then(function(registration) {
            console.log('Service Worker ç™»éŒ²æˆåŠŸï¼', registration.scope);
          })
          .catch(function(error) {
            console.log('Service Worker ç™»éŒ²å¤±æ•—:', error);
          });
      }
    };
  </script>

</body>
</html>
